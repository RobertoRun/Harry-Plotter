<html>
<head>
	<meta charset="UTF-8">
	<meta name="author" content="niko" />
	<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
	<title>Harry Plotter - Generator</title>
	<style>
		body { margin:0; padding:0; font:normal 9pt "Sans Serif","Trebuchet MS"; }
		form { display:block; width:700px; float:left; background-color:#aaa; padding:0; }
		div { margin: 5px; }
		div#container { border: 1px #ddd dotted; }
		div#js { margin: 0; padding: 3px; }
		div.formcol { float:left; width:49%; margin: 4px 0 4px 0; }
		div.footer { clear:both; margin-top:10px; text-align:right; }
		pre { font-size:8pt; margin:0; padding:0; height:350px; overflow:auto; width:300px}
		table { font:normal 9pt "Sans Serif","Trebuchet MS"; }
		label { display:block; width:105px; float:left; text-align:right; Margin-right:5px; }
		input[type="button"],input[type="reset"] { font:bold 9pt "Sans Serif","Trebuchet MS"; border:none; background-color:#444; color:#fff; }
		input[type="text"],select { color:#000; height:15px; font:normal 11px "Sans Serif","Trebuchet MS"; border:none; background-color:#ddd; }
		input.int { width:80px; }
		input[type=color] { height:16px; background-color:#ccc; border:none; }
		input.font { width:220px; }
		input.data { width:280px; }
		#render { display:block; float:left; }
		#js { background-color:#888; color:#fff; }
		h1 { font-size:12pt; margin:2px 0 3px 0; }
		h2 { font-size:10pt; background-color:#666; color:#fff; margin:0; padding: 1px 0 1px 3px; clear:both; }
		::-webkit-input-placeholder { color:#999; }
		input:-moz-placeholder { color:#999; }
	</style>
	<script src="harry.js"></script>
	<script>
		var TPL= {
			"Dark River": {
				datas:[{values:[51,52,47,6,5,86,95,93,96,22,55,49,21,21,6,49],color:"#fc0"},{values:[59,21,30,86,5,75,24,92,80,11,22,83,19,91,99,74],color:"#0cf"},{values:[58,0,5,40,82,37,37,77,92,76,38,47,98,43,38,42]}],
				title:{text:"DARK RIVER",font:"bold 24px \"Sans Serif\"",color:"#fff",shadow:"0,0,8,#fff"},
				labels:{x:1,y:[25,50,100],color:"#ddd",ypos:"right"},
				background:"#000",
				mode:"curve:river",
				fill:"solid",
				opacity:0.8,
				linewidth:3,
				legends:{background:"#666",color:"#fff",shadowbox:"1,1,1,#fff"}
			}
		};
		window.onload=function(){			
			var
			MAXDATA=16,
			
			_=function(id){
				return document.getElementById(id);
			},
			
			val=function(id,val){
				var o=_(id);
				if(val!==undefined) o.value=val;
				return o.value;
			},
			
			json={

				encode: function(o,jsquote) { /*ignore functions*/
					if(o==undefined) return 'null';
					jsquote=jsquote||false;
					var lines=[], isarray=(o.constructor==Array),k,v,s;
					for(k in o) {
						v=o[k];
						if(typeof v=="object") {
							if(isarray) lines.push(json.encode(v,jsquote));
							else lines.push((jsquote?k:'"'+k+'"')+':'+json.encode(v,jsquote));
						} else if(typeof v!="function") {
							s=(isarray)?"":(jsquote?k+':':'"'+k+'":');
							if(typeof v=="number") s+=v.toString(10);
							else if(v===false) s+='false';
							else if(v===true) s+='true';
							else s+='"'+(v || "").replace(/"/g,"\\\"").replace(/\n|\r/g,' ')+'"';
							lines.push(s);
						}
					}
					return (isarray) ? "["+lines.join(",")+"]" : "{"+lines.join(",")+"}";
				},

				tidy: function(txt) {
					txt=txt.replace(/\n|\r|\t/gi,"").replace(/^\s+/g,'');
					var l=txt.length,n=0,c,nc,i=0,fmt="",iq=false,ip=0,newline=function(i){ return "\n"+("                                   ".substr(0,i*3)); };
					while(n<l) {
						c=txt[n++];
						nc=(n<l) ? txt[n] : '';
						if(c=='"') { fmt+=c; iq=!iq; } 
						else if(iq) fmt+=c;
						else if(c=='[') {ip++; fmt+=c;}
						else if(c==']') {ip--; fmt+=c;}
						else if(ip)     fmt+=c;
						else if(c=='{') fmt+=c+newline(++i);
						else if(c==',') fmt+=c+newline(i);
						else if(c=='}') fmt+=newline(--i)+c;
						else fmt+=c;
					}
					return fmt;
				}
			},

			isEmpty=function(o){
  				for(var i in o) return false;
  				return true;
			}

			values=function(str){
				var n,s=str.split(/\s*,\s*/),i,v,k;
				if(/:/.test(str)){
					n={};
					for(i=0;i<s.length;i++){
						if(s[i].match(/^(.+)\:(.+)$/)){
							k=RegExp.$1;
							v=RegExp.$2;
						} else {
							k=i;
							v=s[i];
						}
						v=v==""||v=="null"?null:parseFloat(v);
						n[k]=v;
					} 
				} else {
					n=[];
					for(i=0;i<s.length;i++){
						v=s[i]==""||s[i]=="null"?null:parseFloat(s[i]);
						n.push(v);
					} 
				}
				return n;
			},

			getlst=function(lst,pfx,h){
				var v;
				if(!h) h={};
				if(typeof(lst)=="string") lst=lst.split(' ');
				lst.forEach(function(l){
					if((v=val((pfx||'')+l)).length)
						if(/^(x|y|radius|radiuspoint|marks|linewidth|width|height)$/.test(l))
							h[l]=parseInt(v,10);
						else if(/^(opacity)$/.test(l))
							h[l]=parseFloat(v);
						else if(/^(margins)$/.test(l))
							h[l]=values(v);
						else
							h[l]=v;
				});
				return h;
			},

			error=function(txt){
				console.log(txt);

			},

			loadjs=function(js){
				if(typeof(js)=="string") {
					js=js
						.replace(/[\n\r]+/g,'')
						.replace(/(^\s+|\s+$)/g,'')
						.replace(/^(plotter|harry)\s*\(/,'')
						.replace(/\s*\)$/,'')
					try{ js=JSON.parse(js) }
					catch(e){ error((e.name||'')+' '+(e.message||'unknown error')) }
				}
				if(c!==undefined)Â {
					var v,n,d,s,l;
					if(js.datas) {
						//set datas
						for(n in js.datas) {
							d=js.datas[n];
							s='';
							if(d.values instanceof Array){
								s=d.values.join(',');
							} else if (typeof(d.values)=='object') {
								l=[];
								for(k in d.values) l.push(k+':'+d.values[k]);
								s=l.join(',');
							}
							val('data'+n,s);
							val('title'+n,d.title||'');
							val('color'+n,d.color||'');
						}


					}

				}
			},

			savejs=function(){
				var o={container:'container'},v,w,i,d=[],ds;
				//get datas
				for(i=1;_('data'+i);i++)
					if((w=val('data'+i)).length) {
						ds=getlst(['title'+i,'color'+i]);
						ds.values=values(w);
						d.push(ds);
					}
				if(d.length) o.datas=d;
				//get title
				if((v=val('titletext')).length) {
					o.title=getlst('font color x y z shadow','title');
					o.title.text=v;
				}
				//get grid
				if((v=val('gridx')).length+(w=val('gridy')).length) {
					o.grid={};
					if(v.length) o.grid.x=/none|false/.test(v)?v:values(v);
					if(w.length) o.grid.y=/none|false/.test(w)?w:values(w);
					if((v=val('gridcolor')).length) o.grid.color=v;
				}
				//get labels
				if((v=val('labelx')).length+(w=val('labely')).length) {
					o.labels=getlst('font color marks shadow ypos','label');
					if(v.length) o.labels.x=parseInt(v,10);
					if(w.length) o.labels.y=values(w);
				}
				//get render
				getlst('width height mode fill opacity margins background linewidth linejoin radiuspoint','',o);
				if(!_('autoscale').checked) o.autoscale=false;
				//get mouseover
				if(_('mouseover').checked) {
					var m=getlst('radius linewidth circle font color border bullet axis text shadow shadowbox','mo');
					if(!isEmpty(m)) o.mouseover=m;
				} else
					o.mouseover=false;
				//get legends
				if(_('legends').checked) {
					var m=getlst('x y font background color border border2 shadow shadowbox','leg');
					if(!isEmpty(m)) o.legends=m;
				} else
					o.legends=false;

				//let's show
				_('jsout').innerText="plotter("+json.tidy(json.encode(o,true))+")";
				_('container').innerHTML='';
				plotter(o);
			};
			
			//_("generate").onclick=savejs;
			for(var i=0, l=document.getElementsByTagName("input"); i<l.length; ++i)
				if(/checkbox|text/.test(l[i].type))
					l[i].onclick=l[i].onkeyup=savejs;
			for(var i=0, l=document.getElementsByTagName("select"); i<l.length; ++i)
				l[i].onclick=l[i].onkeyup=savejs;

			_("butrnd1").onclick=
			_("butrnd2").onclick=
			_("butrnd3").onclick=function(){
				var i,t=this.getAttribute('target'), d=[];
				for(i=0;i<MAXDATA;++i) d.push(Math.floor(Math.random()*100));
				_(t).value=d.join(',');
				savejs();
			};

			savejs();			
		};
	</script>
</head>
<body>
	<h1>Harry Plotter v0.8 - Generator [<a href="index.html">demo</a>] [<a href="https://github.com/nikopol/Harry-Plotter">fork me!</a>]</h1>
	<form>
		
		<h2>Title</h2>
		<div class="formcol">
			<label for="titletext">text</label><input type="text" id="titletext" /><br/>
			<label for="titlefont">font</label><input type="text" id="titlefont" class="font" value='bold 24px "Sans Serif"' /><br/>
			<label for="titlecolor">color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="titlecolor" value="" /><br/>
			<label for="titleshadow">shadow</label><input type="text" placeholder="x,y,blur,color" id="titleshadow" value="" /><br/>
		</div>
		<div class="formcol">
			<label for="titlex">x</label><input type="text" id="titlex" class="int" />px<br/>
			<label for="titley">y</label><input type="text" id="titley" class="int" />px<br/>
			<label for="titlez">z</label><select id="titlez"><option value="">top</option><option value="background">background</option></select><br/>
		</div>
		
		<h2>Datasets</h2>
		<table>
			<tr><th>#</th><th>values</th><th>title</th><th>color</th></tr>
			<tr>
				<td>#1</td>
				<td><input type="text" id="data1" placeholder="y1,y2,y3... or L1:y1,L2:y2,..." value="1,2,4,8,16,32,64,32,16,8,4,2,1" class="data" /><input id="butrnd1" type="button" class="rnd" value="random" target="data1" /></td>
				<td><input type="text" id="title1" value="" /></td>
				<td><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="color1" value="" /></td>
			</tr>
			<tr>
				<td>#2</td>
				<td><input type="text" id="data2" placeholder="y1,y2,y3... or L1:y1,L2:y2,..." value="" class="data" /><input id="butrnd2" type="button" class="rnd" value="random" target="data2" /></td>
				<td><input type="text" id="title2" value="" /></td>
				<td><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="color2" value="" /></td>
			</tr>
			<tr>
				<td>#3</td>
				<td><input type="text" id="data3" placeholder="y1,y2,y3... or L1:y1,L2:y2,..." value="" class="data" /><input id="butrnd3" type="button" class="rnd" value="random" target="data3" /></td>
				<td><input type="text" id="title3" value="" /></td>
				<td><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="color3" value="" /></td>
			</tr>
		</table>

		<h2>Rendering</h2>
		<div class="formcol">
			<label for="background">background</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="background" value="" /><br/>
			<label for="width">width</label><input type="text" id="width" class="int" value="" />px<br/>
			<label for="height">height</label><input type="text" id="height" class="int" value="" />px<br/>
			<label for="mode">mode</label><select id="mode"><option></option><option>line</option><option>line:river</option><option>pie</option><option>chart</option><option>chart:stack</option><option selected="selected">curve</option><option>curve:river</option></select><br/>
			<label for="autoscale">autoscale</label><input type="checkbox" id="autoscale" checked="checked" /><br/>
		</div>
		<div class="formcol">
			<label for="fill">fill</label><select id="fill"><option></option><option>none</option><option>solid</option><option>light</option><option>dark</option><option>vertical</option><option>horizontal</option><option>radial</option></select><br/>
			<label for="opacity">opacity</label><select id="opacity"><option></option><option value="0.1">0.1 - transparent</option><option>0.2</option><option>0.3</option><option>0.4</option><option value="0.5">0.5 - semi transparent</option><option>0.6</option><option>0.7</option><option>0.8</option><option>0.9</option><option value="1">1.0 - opaque</option></select><br/>
			<label for="linewidth">linewidth</label><select id="linewidth"><option></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select><br/>
			<label for="linejoin">linejoin</label><select id="linejoin"><option></option><option>round</option><option>miter</option><option>bevel</option></select>(line or histogram mode)<br/>
			<label for="radiuspoint">radiuspoint</label><select id="radiuspoint"><option></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>10</option><option>15</option><option>20</option><option>40</option></select> (line or curve mode)<br/>
		</div>
		
		<h2>Grid</h2>
		<div class="formcol">
			<label for="gridx">x</label><input type="text" id="gridx" placeholder="none or %,%,%..." value="" /><br/>
			<label for="gridy">y</label><input type="text" id="gridy" placeholder="none or %,%,%..." value="" /><br/>
		</div>
		<div class="formcol">
			<label for="gridcolor">color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="gridcolor" value="" /><br/>
		</div>
		
		<h2>Labels</h2>
		<div class="formcol">
			<label for="margins">margins</label><input type="text" id="margins" placeholder="top,right,bottom,left" value="" /> px<br/>
			<label for="labelfont">font</label><input type="text" id="labelfont" class="font" value='' /><br/>
			<label for="labelcolor">color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="labelcolor" value="" /><br/>
			<label for="labelshadow">shadow</label><input type="text" placeholder="x,y,blur,color" id="labelshadow" value="" /><br/>
		</div>
		<div class="formcol">
			<label for="labely">y axis labels</label><input type="text" id="labely" placeholder="%,%,%..." value="" title="show veritcals labels for each labels.y percent"/><br/>
			<label for="labelypos">y axis position</label><select id="labelypos"><option value=""></option><option>left</option><option>right</option><option>left+right</option></select><br/>
			<label for="labelx">x axis labels</label><select id="labelx"><option value="">none</option><option value="1">all</option><option value="2">1/2</option><option value="3">1/3</option><option value="4">1/4</option><option value="5">1/5</option><option value="10">1/10</option><option value="20">1/20</option></select><br/>
			<label for="labelmarks">marks</label><select id="labelmarks"><option></option><option>1</option><option>2</option><option>3</option><option>4</option></select>px<br/>
		</div>

		<h2>Legends</h2>
		<div class="formcol">
			<label for="legends">enabled</label><input type="checkbox" id="legends" checked="checked" /><br/>
			<label for="legx">x</label><input type="text" id="legx" placeholder="int" value="" /><br/>
			<label for="legy">y</label><input type="text" id="legy" placeholder="int" value="" /><br/>
			<label for="legbackground">background</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="legbackground" value="" /><br/>
			<label for="legshadowbox">box shadow</label><input type="text" placeholder="x,y,blur,color" id="legshadowbox" value="" /><br/>
		</div>
		<div class="formcol">
			<label for="legfont">font</label><input type="text" id="legfont" placeholder='normal 10px "Sans Serif"' class="font" value="" /><br/>
			<label for="legcolor">color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="legcolor" value="" alt="legend border color"/><br/>
			<label for="legshadow">text shadow</label><input type="text" placeholder="x,y,blur,color" id="legshadow" value="" /><br/>
			<label for="legborder">border</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="legborder" value="" alt="legend border color"/><br/>
			<label for="legborder2">color box border</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="legborder2" value="" alt="color box border color"/><br/>
		</div>

		<h2>MouseOver</h2>
		<div class="formcol">
			<label for="mouseover">enabled</label><input type="checkbox" id="mouseover" checked="checked" /><br/>
			<label for="moradius">spot radius</label><input type="text" id="moradius" class="int" value="" />px<br/>
			<label for="molinewidth">spot linewidth</label><select id="molinewidth"><option></option><option value="0">filled</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select><br/>
			<label for="mocircle">spot color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="mocircle" value="" /><br/>
			<label for="moborder2">spot border</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="mocircle" value="" /><br/>
			<label for="moaxis">axis</label><select id="moaxis"><option></option><option>xy</option><option>x</option><option>y</option></select><br/>
		</div>
		<div class="formcol">
			<label for="motext">text</label><input type="text" id="motext" title="%l=label %v=value %n=index" paceholder="%l: %v" value=""/><br/>
			<label for="mofont">text font</label><input type="text" id="mofont" placeholder='normal 10px "Sans Serif"' class="font" value="" /><br/>
			<label for="mocolor">text color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="mocolor" value="" /><br/>
			<label for="moshadow">text shadow</label><input type="text" placeholder="x,y,blur,color" id="moshadow" value="" /><br/>
			<label for="mobullet">bullet color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="mobullet" value="" /><br/>
			<label for="moshadowbox">bullet shadow</label><input type="text" placeholder="x,y,blur,color" id="moshadowbox" value="" /><br/>
			<label for="moborder">bullet border</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="moborder" value="" /><br/>
		</div>

		<div class="footer">
			<input type="reset" value="reset" />
			<!--<input type="button" id="generate" value="generate" />-->
		</div>
	</form>
	<div id="render">
		<h2>Canvas</h2>
		<div id="container"></div>
		<h2>Javascript</h2>
		<div id="js"><pre id="jsout"></pre></div>
	</div>
</body>
</html>

