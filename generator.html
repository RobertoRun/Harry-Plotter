<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<meta name="author" content="niko" />
	<title>Harry Plotter - Generator</title>
	<style>
		body { margin:0; padding:0; font:normal 9pt "Sans Serif","Trebuchet MS"; }
		form { display:block; width:700px; float:left; background-color:#aaa; padding:0; }
		div { margin: 5px; }
		div#container { border: 1px #ddd dotted; }
		div#js { margin: 0; padding: 3px; }
		div.formcol { float:left; width:49%; margin: 4px 0 4px 0; }
		div.footer { clear:both; margin-top:10px; text-align:right; }
		pre { font-size:8pt; margin:0; padding:0; height:350px; overflow:auto; width:300px}
		table { font:normal 9pt "Sans Serif","Trebuchet MS"; }
		label { display:block; width:90px; float:left; text-align:right; Margin-right:5px; }
		input[type="button"],input[type="reset"] { font:bold 9pt "Sans Serif","Trebuchet MS"; border:none; background-color:#444; color:#fff; }
		input[type="text"],select { height:15px; font:normal 11px "Sans Serif","Trebuchet MS"; border:none; background-color:#ddd; }
		input.int { width:80px; }
		input[type=color] { height:16px; background-color:#ccc; border:none; }
		input.font { width:240px; }
		input.data { width:280px; }
		#render { display:block; float:left; }
		#js { background-color:#888; color:#fff; }
		h1 { font-size:12pt; margin:2px 0 3px 0; }
		h2 { font-size:10pt; background-color:#666; color:#fff; margin:0; padding: 1px 0 1px 3px; clear:both; }
	</style>
	<script src="harry.js"></script>
	<script>
		var MAXDATA=16;
		
		var _=function(id){ return document.getElementById(id); };
		var val=function(id){ return document.getElementById(id).value; };

		var values=function(str){
			var n,s=str.split(/\s*,\s*/),i,v,k;
			if(/:/.test(str)){
				n={};
				for(i=0;i<s.length;i++){
					if(s[i].match(/^(.+)\:(.+)$/)){
						k=RegExp.$1;
						v=RegExp.$2;
					} else {
						k=i;
						v=s[i];
					}
					v=v==""||v=="null"?null:parseFloat(v,10);
					n[k]=v;
				} 
			} else {
				n=[];
				for(i=0;i<s.length;i++){
					v=s[i]==""||s[i]=="null"?null:parseFloat(s[i],10);
					n.push(v);
				} 
			}
			return n;
		};
		
		var json={
			encode: function(o,jsquote) { /*ignore functions*/
				if(o==undefined) return 'null';
				jsquote=jsquote||false;
				var lines=[], isarray=(o.constructor==Array),k,v,s;
				for(k in o) {
					v=o[k];
					if(typeof v=="object") {
						if(isarray) lines.push(json.encode(v,jsquote));
						else lines.push((jsquote?k:'"'+k+'"')+':'+json.encode(v,jsquote));
					} else if(typeof v!="function") {
						s=(isarray)?"":(jsquote?k+':':'"'+k+'":');
						if(typeof v=="number") s+=v.toString(10);
						else if(v===false) s+='false';
						else if(v===true) s+='true';
						else s+='"'+(v || "").replace(/"/g,"\\\"").replace(/\n|\r/g,' ')+'"';
						lines.push(s);
					}
				}
				return (isarray) ? "["+lines.join(",")+"]" : "{"+lines.join(",")+"}";
			},
			tidy: function(txt) {
				txt=txt.replace(/\n|\r|\t/gi,"").replace(/^\s+/g,'');
				var l=txt.length,n=0,c,nc,i=0,fmt="",iq=false,ip=0,newline=function(i){ return "\n"+("                                   ".substr(0,i*3)); };
				while(n<l) {
					c=txt[n++];
					nc=(n<l) ? txt[n] : '';
					if(c=='"') { fmt+=c; iq=!iq; } 
					else if(iq) fmt+=c;
					else if(c=='[') {ip++; fmt+=c;}
					else if(c==']') {ip--; fmt+=c;}
					else if(ip)     fmt+=c;
					else if(c=='{') fmt+=c+newline(++i);
					else if(c==',') fmt+=c+newline(i);
					else if(c=='}') fmt+=newline(--i)+c;
					else fmt+=c;
				}
				return fmt;
			}
		}
		
		window.onload=function(){
			
			_("butrnd1").onclick=
			_("butrnd2").onclick=
			_("butrnd3").onclick=function(){
				var i,t=this.getAttribute('target'), d=[];
				for(i=0;i<MAXDATA;++i) d.push(Math.floor(Math.random()*100));
				_(t).value=d.join(',');
			};

			var isEmpty=function(o){
  				for(var i in o) return false;
  				return true;
			};
			
			var build=function(){
				var o={container:'container'},v,w;

				//get datas
				var i,d=[];
				for(i=1;i<4;i++)
					if((w=val('data'+i)).length) {
						ds={values:values(w)};
						if((v=val('title'+i)).length) ds.title=v;
						if((v=val('color'+i)).length) ds.color=v;
						d.push(ds);
					}
				if(d.length) o.datas=d;

				//get title
				if((v=val('titletext')).length){
					o.title={text:v};
					if((v=val('titlefont')).length) o.title.font=v;
					if((v=val('titlecolor')).length) o.title.color=v;
					if((v=val('titlex')).length) o.title.x=v;
					if((v=val('titley')).length) o.title.y=v;
					if((v=val('titlez')).length) o.title.z=v;
				}

				//get grid
				if((v=val('gridx')).length+(w=val('gridy')).length){
					o.grid={};
					if(v.length) o.grid.x=/none|false/.test(v)?v:values(v);
					if(w.length) o.grid.y=/none|false/.test(w)?w:values(w);
					if((v=val('gridcolor')).length) o.grid.color=v;
				}

				//get labels
				if((v=val('margins')).length) o.margins=values(v);
				if((v=val('labelx')).length+(w=val('labely')).length){
					o.labels={};
					if(v.length) o.labels.x=parseInt(v,10);
					if(w.length) o.labels.y=values(w);
					if((v=val('labelfont')).length) o.labels.font=v;
					if((v=val('labelcolor')).length) o.labels.color=v;
				}

				//get render
				if((v=val('width')).length) o.width=parseInt(v,10);
				if((v=val('height')).length) o.height=parseInt(v,10);
				if((v=val('mode')).length) o.mode=v;
				if((v=val('fill')).length) o.fill=v;
				if((v=val('opacity')).length) o.opacity=parseFloat(v,10);
				if((v=val('linewidth')).length) o.linewidth=parseInt(v,10);
				if((v=val('linejoin')).length) o.linejoin=v;
				if((v=val('radiuspoint')).length) o.radiuspoint=parseInt(v,10);
				if(!_('autoscale').checked) o.autoscale=false;
				if(_('mouseover').checked){
					var m={};
					if((v=val('moradius')).length) m.radius=parseInt(v,10);
					if((v=val('molinewidth')).length) m.linewidth=parseInt(v,10);
					if((v=val('mocircle')).length) m.circle=v;
					if((v=val('mofont')).length) m.font=v;
					if((v=val('mocolor')).length) m.color=v;
					if((v=val('moborder')).length) m.border=v;
					if((v=val('mobullet')).length) m.bullet=v;
					if((v=val('moaxis')).length) m.axis=v;
					if((v=val('motext')).length) m.text=v;
					if(!isEmpty(m)) o.mouseover=m;
				} else
					o.mouseover=false;

				//let's show
				_('jsout').innerText="plotter("+json.tidy(json.encode(o,true))+")";
				_('container').innerHTML='';
				plotter(o);
			};
			_("generate").onclick=build;
			build();
			
		};
	</script>
</head>
<body>
	<h1>Harry Plotter v0.6 - Generator page [<a href="index.html">demo</a>] [<a href="https://github.com/nikopol/Harry-Plotter">fork me!</a>]</h1>
	<form>
		
		<h2>Title</h2>
		<div class="formcol">
			<label for="titletext">title.text</label><input type="text" id="titletext" /><br/>
			<label for="titlefont">title.font</label><input type="text" id="titlefont" class="font" value='bold 24px "Sans Serif"' /><br/>
			<label for="titlecolor">title.color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="titlecolor" value="" /><br/>
		</div>
		<div class="formcol">
			<label for="titlex">title.x</label><input type="text" id="titlex" class="int" />px<br/>
			<label for="titley">title.y</label><input type="text" id="titley" class="int" />px<br/>
			<label for="titlez">title.z</label><select id="titlez"><option value="">top</option><option value="bg">background</option></select><br/>
		</div>
		
		<h2>Datasets</h2>
		<table>
			<tr><th>#</th><th>values</th><th>title</th><th>color</th></tr>
			<tr>
				<td>#1</td>
				<td><input type="text" id="data1" placeholder="y1,y2,y3... or L1:y1,L2:y2,..." value="1,2,4,8,16,32,64,32,16,8,4,2,1" class="data" /><input id="butrnd1" type="button" class="rnd" value="random" target="data1" /></td>
				<td><input type="text" id="title1" value="" /></td>
				<td><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="color1" value="" /></td>
			</tr>
			<tr>
				<td>#2</td>
				<td><input type="text" id="data2" placeholder="y1,y2,y3... or L1:y1,L2:y2,..." value="" class="data" /><input id="butrnd2" type="button" class="rnd" value="random" target="data2" /></td>
				<td><input type="text" id="title2" value="" /></td>
				<td><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="color2" value="" /></td>
			</tr>
			<tr>
				<td>#3</td>
				<td><input type="text" id="data3" placeholder="y1,y2,y3... or L1:y1,L2:y2,..." value="" class="data" /><input id="butrnd3" type="button" class="rnd" value="random" target="data3" /></td>
				<td><input type="text" id="title3" value="" /></td>
				<td><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="color3" value="" /></td>
			</tr>
		</table>
		
		<h2>Grid</h2>
		<div class="formcol">
			<label for="gridx">grid.x</label><input type="text" id="gridx" placeholder="none or %,%,%..." value="" /><br/>
			<label for="gridy">grid.y</label><input type="text" id="gridy" placeholder="none or %,%,%..." value="" /><br/>
		</div>
		<div class="formcol">
			<label for="gridcolor">grid.color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="gridcolor" value="" /><br/>
		</div>
		
		<h2>Labels</h2>
		<div class="formcol">
			<label for="margins">margins</label><input type="text" id="margins" placeholder="top,right,bottom,left" value="" /> in px<br/>
			<label for="labelfont">labels.font</label><input type="text" id="labelfont" class="font" value='normal 9px "Sans Serif"' /><br/>
			<label for="labelcolor">labels.color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="labelcolor" value="" /><br/>
		</div>
		<div class="formcol">
			<label for="labely">labels.y</label><input type="text" id="labely" placeholder="%,%,%..." value="0,50,100" title="show veritcals labels for each labels.y percent"/><br/>
			<label for="labelx">labels.x</label><input type="text" id="labelx" placeholder="int" value="1" title="show horizontals labels every labels.x"/><br/>
		</div>

		<h2>Rendering</h2>
		<div class="formcol">
			<label for="width">width</label><input type="text" id="width" class="int" value="" />px<br/>
			<label for="height">height</label><input type="text" id="height" class="int" value="" />px<br/>
			<label for="mode">mode</label><select id="mode"><option></option><option>line</option><option>line:river</option><option>pie</option><option>chart</option><option>chart:stack</option><option selected="selected">curve</option><option>curve:river</option></select><br/>
			<label for="autoscale">autoscale</label><input type="checkbox" id="autoscale" checked="checked" /><br/>
			
		</div>
		<div class="formcol">
			<label for="fill">fill</label><select id="fill"><option></option><option selected="selected">none</option><option>solid</option><option>vertical</option><option>horizontal</option><option>radial</option></select><br/>
			<label for="opacity">opacity</label><select id="opacity"><option></option><option value="0.1">0.1 - transparent</option><option>0.2</option><option>0.3</option><option>0.4</option><option value="0.5">0.5 - semi transparent</option><option>0.6</option><option>0.7</option><option>0.8</option><option>0.9</option><option value="1">1.0 - opaque</option></select><br/>
			<label for="linewidth">linewidth</label><select id="linewidth"><option></option><option>1</option><option>2</option><option  selected="selected">3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select><br/>
			<label for="linejoin">linejoin</label><select id="linejoin"><option></option><option>round</option><option>miter</option><option>bevel</option></select>(line or histogram mode)<br/>
			<label for="radiuspoint">radiuspoint</label><select id="radiuspoint"><option></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>10</option><option>15</option><option>20</option><option>40</option></select> (line or curve mode)<br/>
		</div>

		<h2>MouseOver</h2>
		<div class="formcol">
			<label for="mouseover">enabled</label><input type="checkbox" id="mouseover" checked="checked" /><br/>
			<label for="moradius">spot radius</label><input type="text" id="moradius" class="int" value="" />px<br/>
			<label for="molinewidth">spot linewidth</label><select id="molinewidth"><option></option><option value="0">filled</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select><br/>
			<label for="mocircle">spot color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="mocircle" value="" /><br/>
			<label for="moaxis">axis</label><select id="moaxis"><option></option><option>xy</option><option>x</option><option>y</option></select>
		</div>
		<div class="formcol">
			<label for="mofont">bullet font</label><input type="text" id="mofont" class="font" value="" /><br/>
			<label for="mocolor">text color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="mocolor" value="" /><br/>
			<label for="mobullet">bullet color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="mobullet" value="" /><br/>
			<label for="moborder">border color</label><input type="text" placeholder="#rrggbb or rgba(r,g,b,a)" id="moborder" value="" /><br/>
			<label for="motext">text</label><input type="text" id="motext" title="%l=label %v=value %n=index" value="%v" />
		</div>

		<div class="footer">
			<input type="reset" value="reset" />
			<input type="button" id="generate" value="generate" />
		</div>
	</form>
	<div id="render">
		<h2>Canvas</h2>
		<div id="container"></div>
		<h2>Javascript</h2>
		<div id="js"><pre id="jsout"></pre></div>
	</div>
</body>
</html>

