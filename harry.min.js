var harryTools={COLORS:"#88a4d7 #d685c9 #86d685 #ffc34f #93c2ea #f28989 #f9eb8a".split(" "),count:0,getRGB:function(a){var b;return a&&a.constructor==Array&&3==a.length?a:(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(a))?[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10)]:(b=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(a))?[2.55*parseFloat(b[1]),2.55*parseFloat(b[2]),2.55*parseFloat(b[3])]:(b=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(a))?
[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]:(b=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(a))?[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)]:[0,0,0]},calcColor:function(a,b,c){a=harryTools.getRGB(a);"array"!=typeof b&&(b=[b,b,b]);for(var d=0;3>d;++d)a[d]=Math.max(Math.min(a[d]+b[d],255),0);return void 0!=c?"rgba("+a.join(",")+","+c+")":"rgb("+a.join(",")+")"},fontPixSize:function(a){var b=a.match(/\d+px/i);return b?parseInt(b,10):(b=a.match(/[0-9\.]+em/i))?
Math.floor(16*parseFloat(b,10)):(b=a.match(/\d+pt/i))?Math.floor(1.3333*parseInt(b,10)):10},scaleUp:function(a){var b=Math.floor(a).toString(),c=parseInt(b.substr(0,1));return c*parseFloat("1E"+(b.length-1))==a?a:this.dmax=(c+1)*parseFloat("1E"+(b.length-1))}},harry=function(a){this.clear();a.canvas?this.canvas=document.getElementById(a.canvas):(this.canvas=document.createElement("canvas"),a.id&&this.canvas.setAttribute("id",a.id),document.getElementById(a.container).appendChild(this.canvas),this.canvas.setAttribute("width",
(a.width||300)+"px"),this.canvas.setAttribute("height",(a.height||150)+"px"));this.w=this.canvas.width;this.h=this.canvas.height;this.id=a.id||"harry"+ ++harryTools.count;this.setmode(a.mode);this.fill=(a.fill||"auto")[0].toLowerCase().replace(/[^nasvhr]/,"a");this.opacity=parseFloat(a.opacity,10)||1;this.linewidth=parseInt(a.linewidth,10)||1;this.linejoin=a.linejoin||"miter";this.radiuspoint=parseInt(a.radiuspoint,10)||0;this.labels=a.labels||{};this.labels.color=this.labels.color||"#a0a0a0";this.labels.font=
this.labels.font||'normal 9px "Sans Serif"';this.labels.fontpx=harryTools.fontPixSize(this.labels.font);this.labels.stepx=this.labels.stepx||1;this.margins=a.margins||[0,0,0,0];this.autoscale=!1===a.autoscale?!1:!0;!1===a.mouseover?this.mouseover=!1:(a.mouseover=a.mouseover||{},this.mouseover={radius:a.mouseover.radius||5,linewidth:void 0!=a.mouseover.linewidth?a.mouseover.linewidth:this.linewidth,circle:a.mouseover.circle||"#888",font:a.mouseover.font||'normal 10px "Sans Serif"',color:a.mouseover.color||
"#fff",bullet:a.mouseover.bullet||"#888",border:a.mouseover.border||"#fff",axis:a.mouseover.axis||!1,text:a.mouseover.text||"%v"});if(!a.margins)if(/pie/.test(this.mode)){var b=this.labels.x?this.labels.fontpx:0;this.margins=[b,b,b,b]}else{var b=this.labels.fontpx,c=Math.floor(this.labels.fontpx/2);this.margins=[this.labels.y?c:0,this.labels.y?4*b:1,this.labels.x?2+b:1,this.labels.x?c:0]}this.grid=a.grid||{};this.grid.color=this.grid.color||"#a0a0a0";this.grid.x=this.grid.x||[0,100];/none|false/.test(this.grid.x)&&
(this.grid.x=[]);this.grid.y=this.grid.y||[0,25,50,75,100];/none|false/.test(this.grid.y)&&(this.grid.y=[]);if(this.title=a.title||!1)if("string"==typeof this.title&&(this.title={text:this.title}),this.title.font||(this.title.font='bold 12px "Sans Serif","Trebuchet MS"'),this.title.color||(this.title.color="rgba(4,4,4,0.3)"),this.title.x||(this.title.x=this.margins[3]+2),this.title.y||(this.title.y=this.margins[0]+12),!this.title.z)this.title.z="top";this.gc=this.canvas.getContext("2d");a.datas&&
this.addDataSets(a.datas);this.rx=this.margins[3]+0.5;this.ry=this.margins[0]+0.5;this.rw=Math.max(this.w-this.margins[1]-this.margins[3],0);this.rh=Math.max(this.h-this.margins[0]-this.margins[2],0);this.rx2=this.rx+this.rw;this.ry2=this.ry+this.rh;this.draw()};
harry.prototype={clear:function(){this.dataset=[];this.dmin=4294967295;this.dmax=0;return this},setmode:function(a){this.mode=a||"line";return this},addDataSets:function(a){if(a.constructor==Array)for(var b=0,c=a.length;b<c;++b)this.addDataSet(a[b]);else this.addDataSet(a);return this},addDataSet:function(a){var b,c=a.values||a,d={val:[],lab:[],len:0,sum:0,avg:0,max:0,min:0xffffffffffff,tit:a.title||"dataset#"+(this.dataset.length+1),col:a.color||harryTools.COLORS[this.dataset.length%harryTools.COLORS.length]};
for(b in c)if(/string|number/.test(typeof c[b])&&(d.val.push(a=parseFloat(c[b],10)),d.lab.push(b),d.sum+=a,a>d.max&&(d.max=a),a<d.min))d.min=a;d.len=d.val.length;d.avg=d.len?d.sum/d.len:0;this.dataset.push(d);this.dlen=this.dataset.length;if(1==this.dlen)this.dmin=d.min,this.dsum=this.dmax=this.autoscale?harryTools.scaleUp(d.max):d.max;else{this.dmin=Math.min(d.min,this.dmin);this.dmax=Math.max(d.max,this.dmax);b=this.dsum=0;for(c=this.dataset[0].val.length;b<c;++b){for(d=a=0;d<this.dataset.length;++d)a+=
this.dataset[d].val[b]||0;a>this.dsum&&(this.dsum=this.autoscale?harryTools.scaleUp(a):a)}}return this},draw:function(a){this.mode=(a||this.mode).toLowerCase();var b=this.mode.split(/:/);this.drawGrid().drawYLabels();if(this.title&&"top"==this.title.z)this[b[0]](1==b.length?!1:b[1]).drawTitle();else this.drawTitle()[b[0]](1==b.length?!1:b[1]);if(this.mouseover&&this[b[0]+"Over"]){var c=this;this.imgdata=this.gc.getImageData(0,0,this.w,this.h);if(void 0!=this.mousepos)c[b[0]+"Over"](c.mousepos.x,c.mousepos.y,
b[1]);this.canvas.onmouseover=function(){c.canvas.onmousemove=function(a){a=a||window.event;c.gc.putImageData(c.imgdata,0,0);c.mousepos={x:a.offsetX,y:a.offsetY};c[b[0]+"Over"](c.mousepos.x,c.mousepos.y,b[1])}};this.canvas.onmouseout=function(){c.mousepos=void 0;c.canvas.onmousemove=null;c.gc.putImageData(c.imgdata,0,0)}}return this},cls:function(){this.gc.clearRect(0,0,this.w,this.h);return this},drawTitle:function(){this.title&&this.gc.font&&(this.gc.font=this.title.font,this.gc.textAlign="left",
this.gc.textBaseline="alphabetic",this.gc.fillStyle=this.title.color,this.gc.fillText(this.title.text,this.title.x,this.title.y));return this},drawGrid:function(){if(/chart|line|curve/.test(this.mode)){var a,b,c;this.gc.lineWidth=this.grid.linewidth||1;this.gc.strokeStyle=this.grid.color;if(this.grid.x){a=0;for(b=this.grid.x.length;a<b;++a)c=this.rx+Math.round(this.rw*this.grid.x[a]/100),this.gc.beginPath(),this.gc.moveTo(c,this.ry),this.gc.lineTo(c,this.ry2),this.gc.stroke()}if(this.grid.y){a=0;
for(b=this.grid.y.length;a<b;++a)c=this.ry2-Math.round(this.rh*this.grid.y[a]/100),this.gc.beginPath(),this.gc.moveTo(this.rx,c),this.gc.lineTo(this.rx2,c),this.gc.stroke()}}return this},drawYLabels:function(){if(this.dlen&&this.labels.y&&this.gc.font)if(/chart|line|curve/.test(this.mode)){var a=/\:[r|s]/.test(this.mode)?this.dsum:this.dmax,b,c,d,g,h,e=10>a?100:100>a?10:1,f=Math.floor(this.labels.fontpx/2.5);this.gc.font=this.labels.font;this.gc.fillStyle=this.labels.color;this.gc.textAlign="left";
b=0;for(c=this.labels.y.length;b<c;++b)d=this.rx2+1,g=this.ry2-Math.round(this.rh*this.labels.y[b]/100),h=Math.round(e*a*this.labels.y[b]/100)/e,this.gc.fillText(h,d,g+f)}else/pie/.test(this.mode);return this},drawXLabel:function(a,b,c,d,g){this.gc.font&&(this.labels.x&&0==a%this.labels.stepx)&&(a="object"==typeof this.labels.x?void 0==this.labels.x[a]?"":this.labels.x[a]:a,this.gc.font=this.labels.font,this.gc.fillStyle=this.labels.color,this.gc.textAlign=d||"center",this.gc.textBaseline=g||"alphabetic",
this.gc.fillText(a,b,c));return this},drawBullet:function(a,b,c,d,g,h){this.gc.font=this.mouseover.font;var e,f,j=0;e=this.labels.x&&void 0!=this.labels.x[g]?this.labels.x[g]:"";var g=("function"==typeof this.mouseover.text?this.mouseover.text(g,d):this.mouseover.text.replace("%v",d).replace("%l",e).replace("%n",g)).split(/\n|\\n/),d=harryTools.fontPixSize(this.mouseover.font)+3,k=3+g.length*d,l=Math.floor(k/2);for(f in g)e=this.gc.measureText(g[f]).width+6,e>j&&(j=e);e=a+c;f=e+j;if(f>=this.rw||h%
2&&0<a-c-j)f=a-c,e=f-j;b+=l;a=b-k;b>=this.rh?(b=this.rh-0.5,a=b-k):0>a&&(a=1.5,b=a+k);this.gc.beginPath();this.gc.moveTo(e,b);this.gc.lineTo(f,b);this.gc.lineTo(f,a);this.gc.lineTo(e,a);this.gc.closePath();this.gc.fillStyle=this.mouseover.bullet;this.gc.fill();this.gc.lineWidth=1;this.gc.lineJoin="round";this.gc.strokeStyle=this.mouseover.border;this.gc.stroke();this.gc.textAlign="left";this.gc.textBaseline="top";this.gc.fillStyle=this.mouseover.color;f=0;for(a+=3;f<g.length;++f,a+=d)this.gc.fillText(g[f],
e+3-1,a);return this},pie:function(){var a=this.dlen;if(a){var b=0,c=[],d=[],g=2*Math.PI,h=[],e=/percent/.test(this.labels.x);if(1<a){for(var f=0,b=a,a=0;a<b;a++)f+=this.dataset[a].avg;if(f)for(a=0;a<b;a++)c[a]=this.dataset[a].avg/f*g,d[a]=this.dataset[a].col,h.push(e?Math.round(100*this.dataset[a].avg/f)+"%":this.dataset[a].avg.toString())}else if(f=this.dataset[0],f.sum){b=f.len;for(a=0;a<b;a++)c[a]=f.val[a]/f.sum*g,d[a]=harryTools.COLORS[a%harryTools.COLORS.length],h.push(e?Math.round(100*f.val[a]/
f.sum)+"%":f.val[a].toString())}var g=this.rx+Math.round(this.rw/2),e=this.ry+Math.round(this.rh/2),f=Math.min(this.rh/2,this.rw/2)-1,j=f+0.7*this.labels.fontpx,k,l=-Math.PI/2,i;this.gc.lineWidth=this.linewidth;this.gc.lineJoin="miter";for(a=0;a<b;a++)i=l+c[a],k=this.getGradient(d[a]),this.gc.beginPath(),this.gc.moveTo(g,e),this.gc.arc(g,e,f,l,i,!1),this.gc.closePath(),k&&(this.gc.fillStyle=k,this.gc.fill()),this.gc.strokeStyle=d[a],this.gc.stroke(),k=(l+i)/2,this.drawXLabel(h[a],g+j*Math.cos(k),
e+j*Math.sin(k),"center","middle"),l=i}return this},chart:function(a){var b=this.dlen;this.overpoints=[];if(b){var c,d,g=this.dataset[0].len,h=1<b?4:0,e=a?1:b,f=g&&b?(this.rw-h*(g-1))/g/e-1:0;0>f&&(f=0);var j,k,l,i=this.rx,m,n=a?this.dsum?this.rh/this.dsum:0:this.dmax?this.rh/this.dmax:0;this.gc.lineWidth=this.linewidth;this.gc.lineJoin="miter";for(d=0;d<b;d++)this.overpoints.push({x:[],y:[],v:[]});for(c=0;c<g;c++){this.drawXLabel(c,i+(f+1)*e/2,this.h-1);l=this.ry2;for(d=0;d<b;d++){j=this.dataset[d];
y0=a?l:this.ry2;l=y0-Math.round(n*j.val[c]);k=Math.round(i);m=Math.round(i+f);this.gc.beginPath();this.gc.moveTo(k,y0);this.gc.lineTo(k,l);this.gc.lineTo(m,l);this.gc.lineTo(m,y0);this.gc.closePath();if(k=this.getGradient(j.col))this.gc.fillStyle=k,this.gc.fill();this.gc.strokeStyle=j.col;this.gc.stroke();this.overpoints[d].x.push(0.5+Math.floor(i+f/2));this.overpoints[d].y.push(l);this.overpoints[d].v.push(l);a||(i+=f+1)}i+=a?f+1+h:h}}return this},chartOver:function(a,b){return this.lineOver(a,b)},
curve:function(a){return this.line(a,!0)},curveOver:function(a,b,c){return this.lineOver(a,b,c,!0)},line:function(a,b){var c=this.dlen,d=a?this.dsum?this.rh/this.dsum:0:this.dmax?this.rh/this.dmax:0,g,h,e,f,j;this.gc.lineWidth=this.linewidth;this.gc.lineJoin=this.linejoin;for(this.overpoints=[];g=this.dataset[--c];)if(1<(j=g.val.length)){var k,l,i=[],m=[];for(e=0;e<j;++e){f=0;if(a)for(h=0;h<=c;h++)f+=this.dataset[h].val[e];else f=g.val[e];i.push(this.rx+Math.round(e*(this.rw/(j-1))));m.push(this.ry2-
Math.round(d*f))}this.overpoints.push({x:i,y:m,v:this.dataset[c].val});e--;i.push(this.rx+Math.round(e*(this.rw/(j-1))));m.push(this.ry2-Math.round(d*f));if(h=this.getGradient(g.col)){this.gc.beginPath();this.gc.moveTo(this.rx,this.ry2);this.gc.lineTo(i[0],m[0]);if(b)for(e=1;e<=j;++e)k=(i[e-1]+i[e])/2,l=(m[e-1]+m[e])/2,this.gc.quadraticCurveTo(i[e-1],m[e-1],k,l);else for(e=0;e<j;++e)this.gc.lineTo(i[e],m[e]);this.gc.lineTo(this.rx2,this.ry2);this.gc.closePath();this.gc.fillStyle=h;this.gc.fill()}this.gc.strokeStyle=
g.col;this.gc.beginPath();this.gc.moveTo(i[0],m[0]);0==c&&this.drawXLabel(0,i[0],this.h);if(b)for(e=1;e<=j;++e)k=(i[e-1]+i[e])/2,l=(m[e-1]+m[e])/2,this.gc.quadraticCurveTo(i[e-1],m[e-1],k,l),0==c&&e<j&&this.drawXLabel(e,i[e],this.h);else for(e=1;e<=j;++e)this.gc.lineTo(i[e-1],m[e-1]),0==c&&e<j&&this.drawXLabel(e,i[e],this.h);this.gc.stroke();if(this.radiuspoint){this.gc.fillStyle=g.col;for(e=0;e<j;++e)this.gc.beginPath(),this.gc.arc(i[e],m[e],this.radiuspoint,0,2*Math.PI),this.gc.closePath(),this.gc.fill()}}return this},
lineOver:function(a,b){var c,d=!1,g,h;if(this.overpoints.length){g=this.overpoints[0].x;for(c=0;c<g.length;++c)if(Math.abs(a-g[c])<h||!1===d)h=Math.abs(a-g[c]),d=c;if(!1!==d){g=this.mouseover.linewidth||1;for(c=0;c<this.overpoints.length;++c){h=this.overpoints[c];this.gc.beginPath();this.gc.lineWidth=g;this.gc.arc(h.x[d],h.y[d],this.mouseover.radius,0,2*Math.PI);0==this.mouseover.linewidth?(this.gc.fillStyle=this.mouseover.circle,this.gc.fill()):(this.gc.strokeStyle=this.mouseover.circle,this.gc.stroke());
if(this.mouseover.axis){this.gc.lineWidth=1;if(/x/i.test(this.mouseover.axis)){for(b=h.y[d]+this.mouseover.radius;b<this.ry2;)this.gc.moveTo(h.x[d],b),b+=2,b>this.ry2&&(b=this.ry2),this.gc.lineTo(h.x[d],b),b+=2;this.gc.stroke()}if(/y/i.test(this.mouseover.axis)){for(a=h.x[d]+this.mouseover.radius;a<this.rx2;)this.gc.moveTo(a,h.y[d]),a+=2,a>this.rx2&&(a=this.rx2),this.gc.lineTo(a,h.y[d]),a+=2;this.gc.stroke()}}this.drawBullet(h.x[d],h.y[d],3+this.mouseover.radius,h.v[d],d,c)}}}},getFillMode:function(){return"a"==
this.fill?(this.opacity=1,/\:river/.test(this.mode)?"v":/line/.test(this.mode)||/curve/.test(this.mode)?1<this.dlen?"n":"v":/chart/.test(this.mode)?1<this.dlen?"s":"v":/pie/.test(this.mode.test)?"r":"s"):this.fill},getGradient:function(a){var b=!1;switch(this.getFillMode()){case "s":b=harryTools.calcColor(a,21,this.opacity);break;case "v":b=this.gc.createLinearGradient(0,this.ry2,0,this.ry);b.addColorStop(0,harryTools.calcColor(a,-48,this.opacity));b.addColorStop(1,harryTools.calcColor(a,48,this.opacity));
this.gc.fillStyle=b;break;case "h":b=this.gc.createLinearGradient(this.rx,0,this.rx2,0);b.addColorStop(0,harryTools.calcColor(a,-48,this.opacity));b.addColorStop(1,harryTools.calcColor(a,48,this.opacity));this.gc.fillStyle=b;break;case "r":b=this.gc.createRadialGradient(this.rx2,this.ry2,0,this.rx,this.ry2,1),b.addColorStop(1,harryTools.calcColor(a,-48,this.opacity)),b.addColorStop(0,harryTools.calcColor(a,48,this.opacity)),this.gc.fillStyle=b}return b}};var plotter=function(a){return new harry(a)};