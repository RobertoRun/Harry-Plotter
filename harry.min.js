// harry plotter 0.8
// ~L~ nikomomo@gmail.com 2009-2012
// https://github.com/nikopol/Harry-Plotter
var harry=function(f){var Y="#88a4d7 #d685c9 #86d685 #ffc34f #93c2ea #f28989 #f9eb8a".split(" "),G=function(d,a,e){var b,d=d&&d.constructor==Array&&3==d.length?d:(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(d))?[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10)]:(b=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(d))?[2.55*parseFloat(b[1]),2.55*parseFloat(b[2]),2.55*parseFloat(b[3])]:(b=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(d))?[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]:(b=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(d))?[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)]:[0,0,0];"array"!=typeof a&&(a=[a,a,a]);for(b=0;3>b;++b)d[b]=Math.max(Math.min(d[b]+a[b],255),0);return void 0!=e?"rgba("+d.join(",")+","+e+")":"rgb("+d.join(",")+")"},U=function(d){var a=d.match(/\d+px/i);return a?parseInt(a,10):(a=d.match(/[0-9\.]+em/i))?Math.floor(16*parseFloat(a)):(a=d.match(/\d+pt/i))?Math.floor(1.3333*
parseInt(a,10)):10},la=function(a){var c=Math.floor(a).toString(),e=parseInt(c.substr(0,1),10);return e*parseFloat("1E"+(c.length-1))==a?a:(e+1)*parseFloat("1E"+(c.length-1))},V=function(a,c){if("object"==typeof c)for(var e in c)a[e]=c[e];return a},ma=function(a){a=a||window.event;if("offsetX"in a)return{x:a.offsetX,y:a.offsetY};for(var c=a.target,a={x:a.pageX,y:a.pageY};c.offsetParent;)a.x-=c.offsetLeft,a.y-=c.offsetTop,c=c.offsetParent;return a},na=function(a,c,e){var b=U(c.font);if(a.pie)return b=
c.x?2*b:!1===e?0:15,[b,b,b,b];var e=Math.floor(b/2),h=m.marks;return a.vertical?[c.y&&/l/i.test(c.ypos)?b+4:c.x?b:0,c.y?b:0,c.y&&/r/i.test(c.ypos)?b+4:c.x?b:1,c.x?60:c.y?b:1]:[c.y?e:0,c.y&&/r/i.test(c.ypos)?4*b:c.x?b:1,c.x?3+b+h:c.y?b:1,c.y&&/l/i.test(c.ypos)?4*b:c.x?e:0]},oa=function(a){for(var c={},a=(a||"line").split(":");a.length;)c[a.pop()]=!0;return c},K;if(f.canvas)K=document.getElementById(f.canvas);else{K=f.container;var za=f.width||300,Aa=f.height||150,Z=document.createElement("canvas"),
$;Z.setAttribute("width",za+"px");Z.setAttribute("height",Aa+"px");K&&($="string"==typeof K?document.getElementById(K):K);$||($=document.body);$.appendChild(Z);K=Z}var x=K,L=x.width,P=x.height,a=x.getContext("2d"),ga,pa=f.background,j=oa(f.mode),R=(f.mode||"line").split(":")[0],qa=(f.fill||"a")[0].toLowerCase().replace(/[^nasvhrdl]+/g,"a"),C=parseFloat(f.opacity)||1,aa=parseInt(f.linewidth,10)||1,Ba=f.linejoin||"miter",ra=parseInt(f.radiuspoint,10)||0,sa=f.autoscale&&/top/i.test(f.autoscale),ha=f.autoscale&&
/bot/i.test(f.autoscale),m=V({color:"#a0a0a0",font:'normal 9px "Sans Serif"',marks:0,ypos:"right"},f.labels),k=!1===f.mouseover?!1:V({radius:5,linewidth:aa,circle:"#888",font:'normal 10px "Sans Serif"',color:"#fff",bullet:"rgba(99,99,99,0.8)",axis:!1,text:"%v"},f.mouseover),D,v=[],S=!1,ta,ia,ja,ua=f.margins?!1:!0,z=ua?na(j,m,k):f.margins,u=V({color:"#a0a0a0",x:[0,100],y:[0,25,50,75,100]},f.grid),E=f.title?V({font:'bold 12px "Sans Serif"',color:"rgba(4,4,4,0.5)",x:z[3]+2,y:z[0]+2,z:"top"},f.title):
!1,w=!1===f.legends?!1:V({x:z[3]+2,y:z[0]+2+(f.title&&!f.title.x?2+U(E.font):0),color:"#666",font:'10px "Sans Serif"'},f.legends),r=[],Q,A,s=0,M,H,T,y,I,B,F,J,p,W,ba=function(){var a,c,e,b;s=r.length;Q=A=!1;H=M=T=0;if(s){for(a=0;a<s;a++)c=r[a],Q=!1===Q?c.min:Math.min(c.min,Q),A=!1===A?c.max:Math.max(c.max,A);sa&&(A=la(A));if(j.stack){a=0;for(e=r[0].len;a<e;++a){for(c=b=0;c<s;++c)b+=r[c].val[a]||0;b>M&&(M=sa?la(b):b)}H=ha?M-Q:M}else M=A,H=ha?A-Q:A;T=ha?Q:0}m.fontpx=U(m.font);/none|false/.test(u.x)&&
(u.x=[]);/none|false/.test(u.y)&&(u.y=[]);ua&&(z=na(j,m,k));y=z[3];I=z[0];B=Math.max(L-z[1]-z[3],0);F=Math.max(P-z[0]-z[2],0);J=y+B;p=I+F},va=function(a){var c,e=a.values||a,b=a.labels||[],h={val:[],lab:[],len:0,sum:0,avg:0,max:0,min:0xffffffffffff,tit:a.title||"dataset#"+(r.length+1),col:a.color||Y[r.length%Y.length]};for(c in e)a=parseFloat(e[c]),h.val.push(null==e[c]?null:a),h.lab.push(b[c]||c),h.sum+=a,a>h.max&&(h.max=a),a<h.min&&(h.min=a);h.len=h.val.length;h.avg=h.len?h.sum/h.len:0;r.push(h)},
wa=function(a){if(a instanceof Array&&"object"==typeof a[0])for(var c=0,e=a.length;c<e;++c)va(a[c]);else va(a);ba()},ca=function(d){var c,e;"a"==qa?(C=1,e=j.stack?"v":j.line||j.curve?1<s?"n":"v":j.chart?1<s?"s":j.vertical?"h":"v":j.pie?"r":"s"):e=qa;switch(e){case "s":c=G(d,0,C);break;case "l":c=G(d,21,C);break;case "d":c=G(d,-21,C);break;case "v":c=a.createLinearGradient(0,p,0,I);c.addColorStop(0,G(d,-48,C));c.addColorStop(1,G(d,48,C));break;case "h":c=a.createLinearGradient(y,0,J,0);c.addColorStop(0,
G(d,-48,C));c.addColorStop(1,G(d,48,C));break;case "r":c=a.createRadialGradient(J,p,0,y,p,1),c.addColorStop(1,G(d,-48,C)),c.addColorStop(0,G(d,48,C))}return c?a.fillStyle=c:!1},N=function(d){d&&a.hasOwnProperty("shadowBlur")&&(d=d.split(/[ ,;:-]/),a.shadowOffsetX=parseInt(d[0]||1,10),a.shadowOffsetY=parseInt(d[1]||1,10),a.shadowBlur=parseInt(d[2]||1,10),a.shadowColor=d[3]||"#000")},O=function(){a.hasOwnProperty("clearShadow")?a.clearShadow():a.hasOwnProperty("shadowBlur")&&(a.shadowOffsetX=0,a.shadowOffsetY=
0,a.shadowBlur=0)},xa=function(){E&&(N(E.shadow),a.font=E.font,a.textAlign="left",a.textBaseline="top",a.fillStyle=E.color,a.fillText(E.text,E.x,E.y),O())},da=function(d,c,e,b,h){a.save();m.x&&0==d%m.x&&(d=r[0].lab[d]||d,N(m.shadow),a.font=m.font,a.fillStyle=m.color,a.textAlign=b||"center",a.textBaseline=h||"alphabetic",a.fillText(d,c,e),O());m.marks&&(a.lineWidth=1,a.beginPath(),a.moveTo(c,p),a.lineTo(c,p+m.marks),a.strokeStyle=m.color,a.stroke());a.restore()},ya=function(d,c){a.save();a.font=k.font;
var e,b,h,l=d.length,g,n,q=0,i=0,ea=U(k.font),f=Math.floor(ea/2),m=ea+3,j,t,X=L;t=0;j=P;var s=0;d.sort(function(a,b){return parseInt(b.v,10)-parseInt(a.v,10)});for(b=0;b<l;b++)if(g=d[b],h=r[g.nds].lab[g.n],n=r[g.nds].tit,h="function"==typeof k.text?k.text(g.n,g.v,h,g.x,g.y):k.text.replace("%v",g.v).replace("%l",h).replace("%n",g.n).replace("%t",n).replace("%p",g.pct)){g.lines=h.split(/\n|\\n/);g.h=g.lines.length*m;g.h2=Math.floor(g.h/2);g.w=0;for(e in g.lines)if((h=a.measureText(g.lines[e]).width+
6)>g.w)g.w=h;g.w>i&&(i=g.w);q+=g.h;g.r++;X>g.x-g.r&&(X=g.x-g.r);t<g.x+g.r&&(t=g.x+g.r);j>g.y&&(j=g.y);s<g.y&&(s=g.y)}1<l&&(i+=6+ea);if(q){q+=3;c?(t=X+(t-X)/2-i/2,t+i>L&&(t=L-1-i)):t+i>=L&&(t=X-i);1>t&&(t=1);t=Math.floor(t);e=t+i;b=j+q/2+q/2;b>p&&(b=p-1);b=Math.floor(b);g=b-q;a.beginPath();a.moveTo(t,b);a.lineTo(e,b);a.lineTo(e,g);a.lineTo(t,g);a.closePath();k.bullet&&(N(k.shadowbox),a.strokStyle="",a.fillStyle=k.bullet,a.fill(),O());k.border&&(a.lineWidth=1,a.lineJoin="round",a.strokeStyle=k.border,
a.stroke());a.textAlign="left";a.textBaseline="top";j=g+3;for(b=0;b<l;b++){g=d[b];q=t+3;1<l&&(a.beginPath(),a.arc(q+f,j+f,f,0,2*Math.PI),a.fillStyle=r[g.nds].col,a.fill(),q+=ea+3);N(k.shadow);a.fillStyle=k.color;for(e=0;e<g.lines.length;++e,j+=m)a.fillText(g.lines[e],q,j);O()}}a.restore()},ka={line:function(){var d=s,c=H?F/H:0,e,b,h,l,g,n="curve"==R,q=function(a,b,c,d,e,g){for(var h,l,i,f,j,q;e<=g;)if(null===d[e])e++;else if(n){h=b[e];l=c[e];for(e++;e<=g&&null===d[e];)e++;e>g?a.lineTo(h,l):(i=(h+
b[e])/2,f=(l+c[e])/2,j=(h+i)/2,q=(l+f)/2,a.quadraticCurveTo(h,l,j,q),j=(i+b[e])/2,q=(f+c[e])/2,a.quadraticCurveTo(i,f,j,q))}else a.lineTo(b[e],c[e]),e++};a.lineWidth=aa;a.lineJoin=Ba;for(v=[];e=r[--d];)if(1<(g=e.len)){var i=[],f=[];for(b=0;b<g;++b){l=0;if(j.stack)for(h=0;h<=d;h++)l+=r[h].val[b]-T;else l=e.val[b]-T;i.push(y+Math.round(b*(B/(g-1))));f.push(p-Math.round(c*l))}v.push({x:i,y:f,v:r[d].val,nds:d});b--;i.push(y+Math.round(b*(B/(g-1))));f.push(p-Math.round(c*l));for(b=0;null===e.val[b];)b++;
for(h=g-1;null===e.val[h];)h--;b<=h&&ca(e.col)&&(a.beginPath(),a.moveTo(i[b],p),a.lineTo(i[b],f[b]),q(a,i,f,e.val,b,h),a.lineTo(i[h],p),a.closePath(),a.fill());a.strokeStyle=e.col;a.beginPath();a.moveTo(i[b],f[b]);q(a,i,f,e.val,b,h);a.stroke();if(0==d)for(b=0;b<g;++b)da(b,i[b],P-3);if(ra){a.fillStyle=e.col;for(b=0;b<g;++b)void 0!=e.val[b]&&(a.beginPath(),a.arc(i[b],f[b],ra,0,2*Math.PI),a.closePath(),a.fill())}}},curve:function(){ka.line()},chart:function(){v=[];if(s){var d,c,e=r[0].len,b=1<s?4:0,
h=j.stack?1:s,l=j.vertical?F:B,l=e&&s?(l-b*(e-1))/e/h-1:0,g,n=I,f,i=y,k,u;d=j.vertical?B:F;var w=j.stack?M?d/M:0:A?d/A:0;0>l&&(l=0);a.lineWidth=aa;a.lineJoin="miter";for(c=0;c<s;c++)v.push({x:[],y:[],v:[],nds:c});if(j.vertical)for(d=0;d<e;d++){da(d,y-m.marks-2,n+l/2,"right","top");i=y;for(c=0;c<s;c++)g=r[c],k=j.stack?i:y,i=k+Math.round(w*g.val[d]),f=Math.round(n),h=Math.round(n+l),null!==g.val[d]&&(a.beginPath(),a.moveTo(k,f),a.lineTo(k,h),a.lineTo(i,h),a.lineTo(i,f),a.closePath(),ca(g.col)&&a.fill(),
a.strokeStyle=g.col,a.stroke()),v[c].x.push(i),v[c].y.push(Math.floor(n+l/2)),v[c].v.push(g.val[d]),j.stack||(n+=l+1);n+=j.stack?l+1+b:b}else for(d=0;d<e;d++){da(d,i+(l+1)*h/2,P-3);n=p;for(c=0;c<s;c++)g=r[c],f=j.stack?n:p,n=f-Math.round(w*g.val[d]),k=Math.round(i),u=Math.round(i+l),null!==g.val[d]&&(a.beginPath(),a.moveTo(k,f),a.lineTo(k,n),a.lineTo(u,n),a.lineTo(u,f),a.closePath(),ca(g.col)&&a.fill(),a.strokeStyle=g.col,a.stroke()),v[c].x.push(Math.floor(i+l/2)),v[c].y.push(n),v[c].v.push(g.val[d]),
j.stack||(i+=l+1);i+=j.stack?l+1+b:b}}},pie:function(){v=[];if(s){var d,c=0,e=[],b=[],h=2*Math.PI,l=[],g=[];if(1<s){var f=0;for(d=0;d<s;d++)f+=r[d].sum;if(f){d=0;for(c=s;d<s;d++)e[d]=r[d].sum/f*h,b[d]=r[d].col,l.push(r[d].sum),g.push(Math.round(100*r[d].sum/f))}}else if(f=r[0],f.sum){c=f.len;for(d=0;d<c;d++)e[d]=f.val[d]/f.sum*h,b[d]=Y[d%Y.length],l.push(f.val[d]),g.push(Math.round(100*f.val[d]/f.sum))}var h=y+Math.round(B/2),f=I+Math.round(F/2),j=Math.min(F/2,B/2)-1,i=j+m.fontpx,k,p,u=1.5*Math.PI,
w,t,z,A,x=S;ta=j;ia=h;ja=f;S=x;a.lineWidth=aa;a.lineJoin="miter";for(d=0;d<c;d++)w=u+e[d],t=(u+w)/2,v.push({a:u%(2*Math.PI),n:d}),d===x?(k=h+10*Math.cos(t),p=f+10*Math.sin(t)):(k=h,p=f),a.beginPath(),a.moveTo(k,p),a.arc(k,p,j,u,w,!1),a.closePath(),ca(b[d])&&a.fill(),a.strokeStyle=b[d],a.stroke(),d===x?(z=k+i/2*Math.cos(t),A=p+i/2*Math.sin(t)):da(l[d],k+i*Math.cos(t),p+i*Math.sin(t),"center","middle"),u=w;!1!==x&&ya([{x:z,y:A,r:0,v:l[x],pct:g[x]+"%",n:x,nds:1<s?x:0}],!0);v.sort(function(a,b){return a.a-
b.a})}}},fa={line:function(d,c){var e,b=!1,h,f,g,n=k.linewidth||1,m=[];if(v.length){h=v[0];for(e=0;e<h.x.length;++e)if(void 0!=h.v[e]&&(g=j.vertical?Math.abs(c-h.y[e]):Math.abs(d-h.x[e]),!1===b||g<f))f=g,b=e;if(!1!==b){for(e=0;e<v.length;++e)if(h=v[e],void 0!=h.v[b]){k.border2&&(a.beginPath(),a.lineWidth=n+2,a.arc(h.x[b],h.y[b],k.radius,0,2*Math.PI),0==k.linewidth?(a.fillStyle=k.border2,a.fill()):(a.strokeStyle=k.border2,a.stroke()));a.beginPath();a.lineWidth=n;a.arc(h.x[b],h.y[b],k.radius,0,2*Math.PI);
0==k.linewidth?(a.fillStyle=k.circle,a.fill()):(a.strokeStyle=k.circle,a.stroke());if(k.axis){a.lineWidth=1;if(/x/i.test(k.axis)){for(f=h.y[b]+k.radius;f<p;)a.moveTo(h.x[b],f),f+=2,f>p&&(f=p),a.lineTo(h.x[b],f),f+=2;a.stroke()}if(/y/i.test(k.axis)){for(d=h.x[b]+k.radius;d<J;)a.moveTo(d,h.y[b]),d+=2,d>J&&(d=J),a.lineTo(d,h.y[b]),d+=2;a.stroke()}}m.push({x:h.x[b],y:h.y[b],r:n/2+1+k.radius,v:h.v[b],n:b,nds:h.nds})}ya(m)}}},chart:function(a,c){fa.line(a,c)},curve:function(a,c){fa.line(a,c)},pie:function(a,
c){var e,b=0;if(Math.sqrt(Math.pow(a-ia,2)+Math.pow(c-ja,2))<=ta){e=Math.PI-Math.atan2(ja-c,a-ia);for(e=(e+3*Math.PI)%(2*Math.PI);b<v.length&&e>v[b].a;)b++;0>--b&&(b=v.length-1);S=v[b].n;W(!0)}else!1!==S&&(S=!1,W(!0))}};W=function(d){a.clearRect(-1,-1,L+1,P+1);pa&&(a.fillStyle=pa,a.fillRect(-1,-1,L+1,P+1));if(!j.pie){var c,e,b;a.lineWidth=u.linewidth||1;a.strokeStyle=u.color;if(u.x){c=0;for(e=u.x.length;c<e;++c)a.beginPath(),j.vertical?(b=I+Math.round(F*u.x[c]/100),a.moveTo(y,b),a.lineTo(J,b)):(b=
y+Math.round(B*u.x[c]/100),a.moveTo(b,I),a.lineTo(b,p)),a.stroke()}if(u.y){c=0;for(e=u.y.length;c<e;++c)a.beginPath(),j.vertical?(b=y+Math.round(B*u.y[c]/100),a.moveTo(b,I),a.lineTo(b,p)):(b=p-Math.round(F*u.y[c]/100),a.moveTo(y,b),a.lineTo(J,b)),a.stroke()}}if(s&&m.y&&!j.pie){var h,f,g=10>H?100:100>H?10:1;N(m.shadow);a.font=m.font;a.fillStyle=m.color;if(j.vertical){a.textAlign="center";c=0;for(e=m.y.length;c<e;++c)b=y+Math.round(B*m.y[c]/100),f=T+H*m.y[c]/100,f=Math.round(g*f)/g,/r/i.test(m.ypos)&&
(h=p+1,a.textBaseline="top",a.fillText(f,b,h)),/l/i.test(m.ypos)&&(h=I-2,a.textBaseline="bottom",a.fillText(f,b,h))}else{a.textBaseline="middle";c=0;for(e=m.y.length;c<e;++c)h=p-Math.round(F*m.y[c]/100),f=T+H*m.y[c]/100,f=Math.round(g*f)/g,/r/i.test(m.ypos)&&(b=J+1,a.textAlign="left",a.fillText(f,b,h)),/l/i.test(m.ypos)&&(b=y-2,a.textAlign="right",a.fillText(f,b,h))}O()}E&&"top"==E.z?(ka[R](),xa()):(xa(),ka[R]());if(!1!==w&&1<s){a.save();a.font=w.font;var n,q,g=0;e=U(w.font)+3;b=e-3;h=s;q=3+e*h;f=
w.x;var i=w.y;for(c=0;c<h;++c)if((n=a.measureText(r[c].tit)).width>g)g=n.width;n=9+b+g;a.lineWidth=1;if(g=w.background)N(w.shadowbox),a.fillStyle=g,a.fillRect(f,i,n,q),O();if(g=w.border)a.strokeStyle=g,a.strokeRect(f,i,n,q);c=0;for(n=i+3;c<h;++c,n+=e){q=r[c];N(w.shadow);a.fillStyle=q.col;a.fillRect(f+3,n,b,b);O();if(g=w.border2)a.strokeStyle=g,a.strokeRect(f+3,n,b,b);N(w.shadow);a.textAlign="left";a.textBaseline="top";a.fillStyle=w.color;a.fillText(q.tit,f+6+b,n);O()}a.restore()}if(!d)if(x.onmouseover=
x.onmousemove=x.onmouseout=void 0,S=!1,k){ga=a.getImageData(0,0,L,P);if(D)fa[R](D.x,D.y);x.onmouseover=function(a){D=ma(a)};x.onmousemove=function(b){D&&(j.pie||a.putImageData(ga,0,0),D=ma(b),fa[R](D.x,D.y))};x.onmouseout=function(){D=void 0;a.putImageData(ga,0,0)}}else D=void 0};a.translate(0.5,0.5);f.datas?wa(f.datas):ba();W();return{canvas:x,data:r,clear:function(){r=[];s=0;ba();return this},load:function(a){wa(a);return this},cls:function(){return this},draw:function(a){a&&(R=(a||"line").split(":")[0],
j=oa(a),ba());W();return this}}},plotter=harry;
