// harry plotter 0.8
// ~L~ nikomomo@gmail.com 2009-2012
// https://github.com/nikopol/Harry-Plotter
var harry=function(f){var Z="#88a4d7 #d685c9 #86d685 #ffc34f #93c2ea #f28989 #f9eb8a".split(" "),D=function(d,a,e){var b,d=d&&d.constructor==Array&&3==d.length?d:(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(d))?[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10)]:(b=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(d))?[2.55*parseFloat(b[1]),2.55*parseFloat(b[2]),2.55*parseFloat(b[3])]:(b=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(d))?[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]:(b=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(d))?[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)]:[0,0,0];"array"!=typeof a&&(a=[a,a,a]);for(b=0;3>b;++b)d[b]=Math.max(Math.min(d[b]+a[b],255),0);return void 0!=e?"rgba("+d.join(",")+","+e+")":"rgb("+d.join(",")+")"},V=function(d){var a=d.match(/\d+px/i);return a?parseInt(a,10):(a=d.match(/[0-9\.]+em/i))?Math.floor(16*parseFloat(a)):(a=d.match(/\d+pt/i))?Math.floor(1.3333*
parseInt(a,10)):10},ka=function(a){var c=Math.floor(a).toString(),e=parseInt(c.substr(0,1),10);return e*parseFloat("1E"+(c.length-1))==a?a:(e+1)*parseFloat("1E"+(c.length-1))},W=function(a,c){if("object"==typeof c)for(var e in c)a[e]=c[e];return a},la=function(a){a=a||window.event;if("offsetX"in a)return{x:a.offsetX,y:a.offsetY};for(var c=a.target,a={x:a.pageX,y:a.pageY};c.offsetParent;)a.x-=c.offsetLeft,a.y-=c.offsetTop,c=c.offsetParent;return a},ma=function(a,c,e){var b=V(c.font);if(a.pie)return b=
c.x?2*b:!1===e?0:15,[b,b,b,b];var e=Math.floor(b/2),i=c.marks;return a.vertical?[c.y&&/l/i.test(c.ypos)?b+4:c.x?b:1,c.y?b:1,c.y&&/r/i.test(c.ypos)?b+4:c.x?b:1,c.x?4+c.xwidth:c.y?b:1]:[c.y?e:1,c.y&&/r/i.test(c.ypos)?4+c.ywidth:c.x?b:1,c.x?3+b+i:c.y?b:1,c.y&&/l/i.test(c.ypos)?4+c.ywidth:c.x?e:1]},na=function(a){for(var c={},a=(a||"line").split(":");a.length;)c[a.pop()]=!0;return c},Q;if(f.canvas)Q=document.getElementById(f.canvas);else a:{var K=f.container,Aa=f.width||300,Ba=f.height||150;Q=document.createElement("canvas");
Q.setAttribute("width",Aa+"px");Q.setAttribute("height",Ba+"px");if(K){if(K="string"==typeof K?document.getElementById(K):K,!K){Q=void 0;break a}}else K=document.body;K.appendChild(Q)}var F=Q,L=F.width,X=F.height,a=F.getContext("2d"),fa,oa=f.background,m=na(f.mode),S=(f.mode||"line").split(":")[0],pa=(f.fill||"a")[0].toLowerCase().replace(/[^nasvhrdl]+/g,"a"),I=parseFloat(f.opacity)||1,$=parseInt(f.linewidth,10)||1,Ca=f.linejoin||"miter",qa=void 0==f.barspace?"a":parseInt(f.barspace,10),ra=parseInt(f.radiuspoint,
10)||0,sa=f.autoscale&&/top/i.test(f.autoscale),ga=f.autoscale&&/bot/i.test(f.autoscale),j=W({color:"#a0a0a0",font:'normal 9px "Sans Serif"',marks:0,xwidth:0,ywidth:0,ypos:"right"},f.labels),k=!1===f.mouseover?!1:W({radius:5,linewidth:2*$,circle:"#888",font:'normal 10px "Sans Serif"',color:"#fff",bullet:"rgba(99,99,99,0.8)",axis:!1,text:"%v"},f.mouseover),G,s=[],T=!1,ta,ha,ia,ua=f.margins?!1:!0,E=ua?ma(m,j,k):f.margins,y=W({color:"#a0a0a0",x:[0,100],y:[0,25,50,75,100]},f.grid),z=f.title?W({font:'bold 12px "Sans Serif"',
color:"rgba(4,4,4,0.5)",z:"top"},f.title):!1,u=!1===f.legends?!1:W({color:"#666",font:'10px "Sans Serif"',layout:"v"},f.legends),t=[],R,v,q=0,M,J,U,A,H,B,C,N,r,aa,Y,ba=function(){var d,c,e,b;q=t.length;R=v=!1;J=M=U=0;j.xwidth=0;a.font=j.font;if(q){for(d=0;d<q;d++)c=t[d],R=!1===R?c.min:Math.min(c.min,R),v=!1===v?c.max:Math.max(c.max,v),c.maxlab&&(j.xwidth=Math.max(j.xwidth,a.measureText(c.maxlab).width));sa&&(v=ka(v));j.ywidth=a.measureText(v||"0").width;if(m.stack){d=0;for(e=t[0].len;d<e;++d){for(c=
b=0;c<q;++c)b+=t[c].val[d]||0;b>M&&(M=sa?ka(b):b)}J=ga?M-R:M}else M=v,J=ga?v-R:v;U=ga?R:0}j.fontpx=V(j.font);"auto"==j.x&&(j.x=1,j.xauto=!0);/none|false/.test(y.x)&&(y.x=[]);/none|false/.test(y.y)&&(y.y=[]);ua&&(E=ma(m,j,k));A=E[3];H=E[0];B=Math.max(L-E[1]-E[3],0);C=Math.max(X-E[0]-E[2],0);N=A+B;r=H+C},va=function(a){var c,e=a.values||a,b=a.labels||[],i,h={val:[],lab:[],len:0,sum:0,avg:0,max:0,min:0xffffffffffff,tit:a.title||"dataset#"+(t.length+1),maxlab:"",col:a.color||Z[t.length%Z.length]};for(c in e)a=
parseFloat(e[c]),isNaN(a)&&(a=null),h.val.push(a),i=b[c]||c,i.length>h.maxlab.length&&(h.maxlab=i),h.lab.push(i),h.sum+=a,a>h.max&&(h.max=a),a<h.min&&(h.min=a);h.len=h.val.length;h.avg=h.len?h.sum/h.len:0;t.push(h)},wa=function(a){if(a instanceof Array&&"object"==typeof a[0])for(var c=0,e=a.length;c<e;++c)va(a[c]);else va(a);ba()},ca=function(d){var c;switch("a"==pa?m.stack?"v":m.line||m.curve?1<q?"n":"v":m.chart?1<q?"s":m.vertical?"h":"v":m.pie?"r":"s":pa){case "s":c=D(d,0,I);break;case "l":c=D(d,
21,I);break;case "d":c=D(d,-21,I);break;case "v":c=a.createLinearGradient(0,r,0,H);c.addColorStop(0,D(d,-48,I));c.addColorStop(1,D(d,48,I));break;case "h":c=a.createLinearGradient(A,0,N,0);c.addColorStop(0,D(d,-48,I));c.addColorStop(1,D(d,48,I));break;case "r":c=A+B/2;var e=H+C/2;c=a.createRadialGradient(c,e,0,c,e,C/2);c.addColorStop(0,D(d,-48,I));c.addColorStop(1,D(d,48,I))}return c?a.fillStyle=c:!1},O=function(d){d&&a.hasOwnProperty("shadowBlur")&&(d=d.split(/[ ,;:-]/),a.shadowOffsetX=parseInt(d[0]||
1,10),a.shadowOffsetY=parseInt(d[1]||1,10),a.shadowBlur=parseInt(d[2]||1,10),a.shadowColor=d[3]||"#000")},P=function(){a.hasOwnProperty("clearShadow")?a.clearShadow():a.hasOwnProperty("shadowBlur")&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},xa=function(){z&&(O(z.shadow),a.font=z.font,a.textAlign="left",a.textBaseline="top",a.fillStyle=z.color,a.fillText(z.text,void 0==z.x?E[3]+2:z.x,void 0==z.y?E[0]+2:z.y),P())},da=function(d,c,e,b,i,h){a.save();c=Math.round(c);e=Math.round(e);if(j.x&&
0==d%j.x){var g=!0,d=t[0].lab[d]||d,n=0;a.font=j.font;j.xauto&&h&&(n=a.measureText(d).width,g=!("h"==h&&"center"==b&&c-n/2<aa||"v"==h&&e<aa));g&&(O(j.shadow),a.fillStyle=j.color,a.textAlign=b,a.textBaseline=i,a.fillText(d,c,e),P(),aa="center"==b?c+n/2:e+j.fontpx)}j.marks&&(a.lineWidth=1,a.beginPath(),a.moveTo(c,r),a.lineTo(c,r+j.marks),a.strokeStyle=j.color,a.stroke());a.restore()},za=function(d,c){a.save();a.font=k.font;var e,b,i,h=d.length,g,n,p=0,l=0,j=V(k.font),f=Math.floor(j/2),m=j+3,x,w,q=L;
w=0;x=X;var ya=0;d.sort(function(a,b){return parseInt(b.v,10)-parseInt(a.v,10)});for(b=0;b<h;b++)if(g=d[b],i=t[g.nds].lab[g.n],n=t[g.nds].tit,i="function"==typeof k.text?k.text(g.n,g.v,i,g.x,g.y):k.text.replace("%v",g.v).replace("%l",i).replace("%n",g.n).replace("%t",n).replace("%p",g.pct)){g.lines=i.split(/\n|\\n/);g.h=g.lines.length*m;g.h2=Math.floor(g.h/2);g.w=0;for(e in g.lines)if((i=a.measureText(g.lines[e]).width+6)>g.w)g.w=i;g.w>l&&(l=g.w);p+=g.h;g.r++;q>g.x-g.r&&(q=g.x-g.r);w<g.x+g.r&&(w=
g.x+g.r);x>g.y&&(x=g.y);ya<g.y&&(ya=g.y)}1<h&&(l+=6+j);if(p){p+=3;c?(w=q+(w-q)/2-l/2,w+l>L&&(w=L-1-l)):w+l>=L&&(w=q-l);1>w&&(w=1);w=Math.floor(w);e=w+l;b=x+p/2+p/2;b>r&&(b=r-1);b=Math.floor(b);g=b-p;a.beginPath();a.moveTo(w,b);a.lineTo(e,b);a.lineTo(e,g);a.lineTo(w,g);a.closePath();k.bullet&&(O(k.shadowbox),a.strokStyle="",a.fillStyle=k.bullet,a.fill(),P());k.border&&(a.lineWidth=1,a.lineJoin="round",a.strokeStyle=k.border,a.stroke());a.textAlign="left";a.textBaseline="top";x=g+3;for(b=0;b<h;b++){g=
d[b];p=w+3;1<h&&(a.beginPath(),a.arc(p+f,x+f,f,0,2*Math.PI),a.fillStyle=t[g.nds].col,a.fill(),p+=j+3);O(k.shadow);a.fillStyle=k.color;for(e=0;e<g.lines.length;++e,x+=m)a.fillText(g.lines[e],p,x);P()}}a.restore()},ja={line:function(){var d=q,c=J?C/J:0,e,b,i,h,g,n="curve"==S,p=r+j.marks+2,l=function(a,b,c,d,e,g){for(var h,i,f,j,l,p;e<=g;)if(null===d[e])e++;else if(n){h=b[e];i=c[e];for(e++;e<=g&&null===d[e];)e++;e>g?a.lineTo(h,i):(f=(h+b[e])/2,j=(i+c[e])/2,l=(h+f)/2,p=(i+j)/2,a.quadraticCurveTo(h,i,
l,p),l=(f+b[e])/2,p=(j+c[e])/2,a.quadraticCurveTo(f,j,l,p))}else a.lineTo(b[e],c[e]),e++};a.lineWidth=$;a.lineJoin=Ca;for(s=[];e=t[--d];)if(1<(g=e.len)){var f=[],k=[];for(b=0;b<g;++b){h=0;if(m.stack)for(i=0;i<=d;i++)h+=t[i].val[b]-U;else h=e.val[b]-U;f.push(A+Math.round(b*(B/(g-1))));k.push(r-Math.round(c*h))}s.push({x:f,y:k,v:t[d].val,nds:d});b--;f.push(A+Math.round(b*(B/(g-1))));k.push(r-Math.round(c*h));for(b=0;null===e.val[b];)b++;for(i=g-1;null===e.val[i];)i--;b<=i&&ca(e.col)&&(a.beginPath(),
a.moveTo(f[b],r),a.lineTo(f[b],k[b]),l(a,f,k,e.val,b,i),a.lineTo(f[i],r),a.closePath(),a.fill());a.strokeStyle=e.col;a.beginPath();a.moveTo(f[b],k[b]);l(a,f,k,e.val,b,i);a.stroke();if(0==d)for(b=0;b<g;++b)da(b,f[b],p,"center","top","h");if(ra){a.fillStyle=e.col;for(b=0;b<g;++b)void 0!=e.val[b]&&(a.beginPath(),a.arc(f[b],k[b],ra,0,2*Math.PI),a.closePath(),a.fill())}}},curve:function(){ja.line()},chart:function(){s=[];if(q){var d,c,e=t[0].len,b="a"==qa?1<q?4:0:qa,i=m.stack?1:q,h=m.vertical?C:B,h=e&&
q?(h-b*(e-1))/e/i-1:0,g,n=H,f,l=A,k,u;d=m.vertical?B:C;var y=r+j.marks+2,x=m.stack?M?d/M:0:v?d/v:0;0>h&&(h=0);a.lineWidth=$;a.lineJoin="miter";for(c=0;c<q;c++)s.push({x:[],y:[],v:[],nds:c});if(m.vertical)for(d=0;d<e;d++){da(d,A-j.marks-2,n,"right","top","v");l=A;for(c=0;c<q;c++)g=t[c],k=m.stack?l:A,l=k+Math.round(x*g.val[d]),f=Math.round(n),i=Math.round(n+h),null!==g.val[d]&&(a.beginPath(),a.moveTo(k,f),a.lineTo(k,i),a.lineTo(l,i),a.lineTo(l,f),a.closePath(),ca(g.col)&&a.fill(),a.strokeStyle=g.col,
a.stroke()),s[c].x.push(l),s[c].y.push(Math.floor(n+h/2)),s[c].v.push(g.val[d]),m.stack||(n+=h+1);n+=m.stack?h+1+b:b}else for(d=0;d<e;d++){da(d,l+(h+1)*i/2,y,"center","top","h");n=r;for(c=0;c<q;c++)g=t[c],f=m.stack?n:r,n=f-Math.round(x*g.val[d]),k=Math.round(l),u=Math.round(l+h),null!==g.val[d]&&(a.beginPath(),a.moveTo(k,f),a.lineTo(k,n),a.lineTo(u,n),a.lineTo(u,f),a.closePath(),ca(g.col)&&a.fill(),a.strokeStyle=g.col,a.stroke()),s[c].x.push(Math.floor(l+h/2)),s[c].y.push(n),s[c].v.push(g.val[d]),
m.stack||(l+=h+1);l+=m.stack?h+1+b:b}}},pie:function(){s=[];if(q){var d,c=0,e=[],b=[],i=2*Math.PI,h=[],g=[];if(1<q){var f=0;for(d=0;d<q;d++)f+=t[d].sum;if(f){d=0;for(c=q;d<q;d++)e[d]=t[d].sum/f*i,b[d]=t[d].col,h.push(t[d].sum),g.push(Math.round(100*t[d].sum/f))}}else if(f=t[0],f.sum){c=f.len;for(d=0;d<c;d++)e[d]=f.val[d]/f.sum*i,b[d]=Z[d%Z.length],h.push(f.val[d]),g.push(Math.round(100*f.val[d]/f.sum))}var i=A+Math.round(B/2),f=H+Math.round(C/2),k=Math.min(C/2,B/2)-1,l=k+j.fontpx,m,r,u=1.5*Math.PI,
x,w,y,z,v=T;ta=k;ha=i;ia=f;T=v;a.lineWidth=$;a.lineJoin="miter";for(d=0;d<c;d++)x=u+e[d],w=(u+x)/2,s.push({a:u%(2*Math.PI),n:d}),d===v?(m=i+10*Math.cos(w),r=f+10*Math.sin(w)):(m=i,r=f),a.beginPath(),a.moveTo(m,r),a.arc(m,r,k,u,x,!1),a.closePath(),ca(b[d])&&a.fill(),a.strokeStyle=b[d],a.stroke(),d===v?(y=m+l/2*Math.cos(w),z=r+l/2*Math.sin(w)):da(h[d],m+l*Math.cos(w),r+l*Math.sin(w),"center","middle"),u=x;!1!==v&&za([{x:y,y:z,r:0,v:h[v],pct:g[v]+"%",n:v,nds:1<q?v:0}],!0);s.sort(function(a,b){return a.a-
b.a})}}},ea={line:function(d,c){var e,b=!1,i,h,g,f=k.linewidth||1,j=[];if(s.length){i=s[0];for(e=0;e<i.x.length;++e)if(void 0!=i.v[e]&&(g=m.vertical?Math.abs(c-i.y[e]):Math.abs(d-i.x[e]),!1===b||g<h))h=g,b=e;if(!1!==b){for(e=0;e<s.length;++e)if(i=s[e],void 0!=i.v[b]){k.border2&&(a.beginPath(),a.lineWidth=f+2,a.arc(i.x[b],i.y[b],k.radius,0,2*Math.PI),0==k.linewidth?(a.fillStyle=k.border2,a.fill()):(a.strokeStyle=k.border2,a.stroke()));a.beginPath();a.lineWidth=f;a.arc(i.x[b],i.y[b],k.radius,0,2*Math.PI);
0==k.linewidth?(a.fillStyle=k.circle,a.fill()):(a.strokeStyle=k.circle,a.stroke());if(k.axis){a.lineWidth=1;if(/x/i.test(k.axis)){for(h=i.y[b]+k.radius;h<r;)a.moveTo(i.x[b],h),h+=2,h>r&&(h=r),a.lineTo(i.x[b],h),h+=2;a.stroke()}if(/y/i.test(k.axis)){for(d=i.x[b]+k.radius;d<N;)a.moveTo(d,i.y[b]),d+=2,d>N&&(d=N),a.lineTo(d,i.y[b]),d+=2;a.stroke()}}j.push({x:i.x[b],y:i.y[b],r:f/2+1+k.radius,v:i.v[b],n:b,nds:i.nds})}za(j)}}},chart:function(a,c){ea.line(a,c)},curve:function(a,c){ea.line(a,c)},pie:function(a,
c){var e,b=0;if(Math.sqrt(Math.pow(a-ha,2)+Math.pow(c-ia,2))<=ta){e=Math.PI-Math.atan2(ia-c,a-ha);for(e=(e+3*Math.PI)%(2*Math.PI);b<s.length&&e>s[b].a;)b++;0>--b&&(b=s.length-1);T=s[b].n;Y(!0)}else!1!==T&&(T=!1,Y(!0))}};Y=function(d){aa=-1;a.clearRect(-1,-1,L+1,X+1);oa&&(a.fillStyle=oa,a.fillRect(-1,-1,L+1,X+1));if(!m.pie){var c,e,b;a.lineWidth=y.linewidth||1;a.strokeStyle=y.color;if(y.x){c=0;for(e=y.x.length;c<e;++c)a.beginPath(),m.vertical?(b=H+Math.round(C*y.x[c]/100),a.moveTo(A,b),a.lineTo(N,
b)):(b=A+Math.round(B*y.x[c]/100),a.moveTo(b,H),a.lineTo(b,r)),a.stroke()}if(y.y){c=0;for(e=y.y.length;c<e;++c)a.beginPath(),m.vertical?(b=A+Math.round(B*y.y[c]/100),a.moveTo(b,H),a.lineTo(b,r)):(b=r-Math.round(C*y.y[c]/100),a.moveTo(A,b),a.lineTo(N,b)),a.stroke()}}if(q&&j.y&&!m.pie){var f,h,g=10>J?100:100>J?10:1;O(j.shadow);a.font=j.font;a.fillStyle=j.color;if(m.vertical){a.textAlign="center";c=0;for(e=j.y.length;c<e;++c)b=A+Math.round(B*j.y[c]/100),h=U+J*j.y[c]/100,h=Math.round(g*h)/g,/r/i.test(j.ypos)&&
(f=r+1,a.textBaseline="top",a.fillText(h,b,f)),/l/i.test(j.ypos)&&(f=H-2,a.textBaseline="bottom",a.fillText(h,b,f))}else{a.textBaseline="middle";c=0;for(e=j.y.length;c<e;++c)f=r-Math.round(C*j.y[c]/100),h=U+J*j.y[c]/100,h=Math.round(g*h)/g,/r/i.test(j.ypos)&&(b=N+1,a.textAlign="left",a.fillText(h,b,f)),/l/i.test(j.ypos)&&(b=A-2,a.textAlign="right",a.fillText(h,b,f))}P()}z&&"top"==z.z?(ja[S](),xa()):(xa(),ja[S]());if(!1!==u&&1<q){a.save();a.font=u.font;var n,p,l,s;e=[];b="h"==u.layout;var v=p=0;f=
V(u.font)+3;h=q;var g=f-3,D=6+g;s=b?3+f:3+f*h;l=void 0!=u.x?u.x:E[3]+2;var x=void 0!=u.y?u.y:E[0]+2+(z&&!z.x?2+V(z.font):0);for(c=0;c<h;++c)n=a.measureText(t[c].tit).width,n>p&&(p=n),e.push(n),v+=n;n=b?(D+6)*h+v:9+g+p;a.lineWidth=1;if(p=u.background)O(u.shadowbox),a.fillStyle=p,a.fillRect(l,x,n,s),P();if(p=u.border)a.strokeStyle=p,a.strokeRect(l,x,n,s);c=0;n=x+3;for(l+=3;c<h;++c){s=t[c];O(u.shadow);a.fillStyle=s.col;a.fillRect(l,n,g,g);P();if(p=u.border2)a.strokeStyle=p,a.strokeRect(l,n,g,g);O(u.shadow);
a.textAlign="left";a.textBaseline="top";a.fillStyle=u.color;a.fillText(s.tit,l+3+g,n);P();b?l+=12+g+e[c]:n+=f}a.restore()}if(!d)if(F.onmouseover=F.onmousemove=F.onmouseout=void 0,T=!1,k){fa=a.getImageData(0,0,L,X);if(G)ea[S](G.x,G.y);F.onmouseover=function(a){G=la(a)};F.onmousemove=function(b){G&&(m.pie||a.putImageData(fa,0,0),G=la(b),ea[S](G.x,G.y))};F.onmouseout=function(){G=void 0;a.putImageData(fa,0,0)}}else G=void 0};a.translate(0.5,0.5);f.datas?wa(f.datas):ba();Y();return{canvas:F,data:t,clear:function(){t=
[];q=0;ba();return this},load:function(a){wa(a);return this},cls:function(){return this},draw:function(a){a&&(S=(a||"line").split(":")[0],m=na(a),ba());Y();return this}}},plotter=harry;