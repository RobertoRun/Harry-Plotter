// harry plotter 0.8
// ~L~ nikomomo@gmail.com 2009-2012
// https://github.com/nikopol/Harry-Plotter
var harry=function(i){var P="#88a4d7 #d685c9 #86d685 #ffc34f #93c2ea #f28989 #f9eb8a".split(" "),B=function(b,a,f){var c,b=b&&b.constructor==Array&&3==b.length?b:(c=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b))?[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)]:(c=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b))?[2.55*parseFloat(c[1]),2.55*parseFloat(c[2]),2.55*parseFloat(c[3])]:(c=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b))?
[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(c=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b))?[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]:[0,0,0];"array"!=typeof a&&(a=[a,a,a]);for(c=0;3>c;++c)b[c]=Math.max(Math.min(b[c]+a[c],255),0);return void 0!=f?"rgba("+b.join(",")+","+f+")":"rgb("+b.join(",")+")"},L=function(b){var a=b.match(/\d+px/i);return a?parseInt(a,10):(a=b.match(/[0-9\.]+em/i))?Math.floor(16*parseFloat(a,10)):(a=b.match(/\d+pt/i))?Math.floor(1.3333*
parseInt(a,10)):10},ea=function(a){var d=Math.floor(a).toString(),f=parseInt(d.substr(0,1));return f*parseFloat("1E"+(d.length-1))==a?a:(f+1)*parseFloat("1E"+(d.length-1))},M=function(a,d){if("object"==typeof d)for(var f in d)a[f]=d[f];return a},fa=function(a){a=a||window.event;if("offsetX"in a)return{x:a.offsetX,y:a.offsetY};for(var d=a.target,a={x:a.pageX,y:a.pageY};d.offsetParent;)a.x-=d.offsetLeft,a.y-=d.offsetTop,d=d.offsetParent;return a},e;if(i.canvas)e=document.getElementById(i.canvas);else{e=
i.container;var Q=i.width||300,V=i.height||150,R=document.createElement("canvas");R.setAttribute("width",Q+"px");R.setAttribute("height",V+"px");(e?document.getElementById(e):document.body).appendChild(R);e=R}var v=e,E=v.width,F=v.height,a=v.getContext("2d"),W,ga=i.background,x=i.mode||"line",ha=(i.fill||"a")[0].toLowerCase().replace(/[^nasvhrdl]/,"a"),u=parseFloat(i.opacity,10)||1,S=parseInt(i.linewidth,10)||1,qa=i.linejoin||"miter",ia=parseInt(i.radiuspoint,10)||0,ja=!1===i.autoscale?!1:!0,n=M({color:"#a0a0a0",
font:'normal 9px "Sans Serif"',marks:0},i.labels),l=!1===i.mouseover?!1:M({radius:5,linewidth:S,circle:"#888",font:'normal 10px "Sans Serif"',color:"#fff",bullet:"rgba(99,99,99,0.8)",border:"#fff",axis:!1,text:"%v"},i.mouseover),t,q=[],K=!1,ka,X,Y,C=!1===i.legends?!1:M({x:5,y:5,color:"#666",border2:"#fff",background:"rgba(255,255,255,0.5)",font:'10px "Sans Serif"'},i.legends);i.margins?e=i.margins:/pie/.test(F.mode)?(e=n.x?2*L(n.font):!1===l?0:10,e=[e,e,e,e]):(e=L(n.font),Q=Math.floor(e/2),V=n.marks,
e=[n.y?Q:0,n.y?4*e:1,n.x?2+e+V:1,n.x?Q:0]);var s=M({color:"#a0a0a0",x:[0,100],y:[0,25,50,75,100]},i.grid),G=i.title?M({font:'bold 12px "Sans Serif"',color:"rgba(4,4,4,0.3)",x:e[3]+2,y:e[0]+2,z:"top"},"string"==typeof i.title?{text:i.title}:i.title):!1,r=[],Z,H,y=0,D,z,N,I,A,J,o,O,la=function(a){var d,f=a.values||a,c=a.labels||[],g={val:[],lab:[],len:0,sum:0,avg:0,max:0,min:0xffffffffffff,tit:a.title||"dataset#"+(r.length+1),col:a.color||P[r.length%P.length]};for(d in f){a=parseFloat(f[d],10);g.val.push(f[d]==
null?null:a);g.lab.push(c[d]||d);g.sum=g.sum+a;if(a>g.max)g.max=a;if(a<g.min)g.min=a}g.len=g.val.length;g.avg=g.len?g.sum/g.len:0;r.push(g);y=r.length;if(y==1){Z=g.min;D=H=ja?ea(g.max):g.max}else{Z=Math.min(g.min,Z);H=Math.max(g.max,H);d=D=0;for(f=r[0].val.length;d<f;++d){for(a=c=0;a<r.length;++a)c=c+(r[a].val[d]||0);c>D&&(D=ja?ea(c):c)}}},ma=function(a){if(a instanceof Array&&typeof a[0]=="object")for(var d=0,f=a.length;d<f;++d)la(a[d]);else la(a)},$=function(b){var d,f;if(ha=="a"){u=1;f=/\:river/.test(x)?
"v":/line/.test(x)||/curve/.test(x)?y>1?"n":"v":/chart/.test(x)?y>1?"s":"v":/pie/.test(x.test)?"r":"s"}else f=ha;switch(f){case "s":d=B(b,0,u);break;case "l":d=B(b,21,u);break;case "d":d=B(b,-21,u);break;case "v":d=a.createLinearGradient(0,o,0,N);d.addColorStop(0,B(b,-48,u));d.addColorStop(1,B(b,48,u));break;case "h":d=a.createLinearGradient(z,0,J,0);d.addColorStop(0,B(b,-48,u));d.addColorStop(1,B(b,48,u));break;case "r":d=a.createRadialGradient(J,o,0,z,o,1);d.addColorStop(1,B(b,-48,u));d.addColorStop(0,
B(b,48,u))}return d?a.fillStyle=d:false},na=function(){if(G&&a.font){a.font=G.font;a.textAlign="left";a.textBaseline="top";a.fillStyle=G.color;a.fillText(G.text,G.x,G.y)}},aa=function(b,d,f,c,g){if(a.font&&n.x&&b%n.x==0){b=r[0].lab[b]||b;a.font=n.font;a.fillStyle=n.color;a.textAlign=c||"center";a.textBaseline=g||"alphabetic";a.fillText(b,d,f)}if(n.marks){a.save();a.lineWidth=1;a.moveTo(d,o);a.lineTo(d,o+n.marks);a.strokeStyle=n.color;a.stroke();a.restore()}},pa=function(b,d){a.save();a.font=l.font;
var f,c,g,j=b.length,h,w,k=0,m=0,T=L(l.font),ba=T/2,i=T+3,e,p,n=E;p=0;e=F;var oa=0;b.sort(function(a,b){return parseInt(b.v,10)-parseInt(a.v,10)});for(c=0;c<j;c++){h=b[c];g=r[h.nds].lab[h.n];w=r[h.nds].tit;if(g=typeof l.text=="function"?l.text(h.n,h.v,g,h.x,h.y):l.text.replace("%v",h.v).replace("%l",g).replace("%n",h.n).replace("%t",w)){h.lines=g.split(/\n|\\n/);h.h=h.lines.length*i;h.h2=Math.floor(h.h/2);h.w=0;for(f in h.lines)if((g=a.measureText(h.lines[f]).width+6)>h.w)h.w=g;if(h.w>m)m=h.w;k=k+
h.h;h.r++;n>h.x-h.r&&(n=h.x-h.r);p<h.x+h.r&&(p=h.x+h.r);if(e>h.y)e=h.y;if(oa<h.y)oa=h.y}}j>1&&(m=m+(6+T));if(k){k=k+3;if(d){p=n+(p-n)/2-m/2;p+m>E&&(p=E-1-m)}else p+m>=E&&(p=n-m);p<1&&(p=1);p=Math.floor(p)+0.5;f=p+m;c=e+k/2+k/2;c>o&&(c=o-1);c=Math.floor(c)+0.5;h=c-k;a.beginPath();a.moveTo(p,c);a.lineTo(f,c);a.lineTo(f,h);a.lineTo(p,h);a.closePath();a.fillStyle=l.bullet;a.fill();a.lineWidth=1;a.lineJoin="round";a.strokeStyle=l.border;a.stroke();a.textAlign="left";a.textBaseline="top";e=h+3;for(c=0;c<
j;c++){h=b[c];k=p+3;if(j>1){a.beginPath();a.arc(k+ba,e+ba,ba,0,2*Math.PI);a.fillStyle=r[h.nds].col;a.fill();k=k+(T+3)}a.fillStyle=l.color;for(f=0;f<h.lines.length;++f,e=e+i)a.fillText(h.lines[f],k,e)}}a.restore()},da={line:function(b,d){var f=y,c=b?D?A/D:0:H?A/H:0,g,j,h,w,k,m=function(a,b,c,g,f,h){for(var j,e,w,k,i,m;f<=h;)if(g[f]===null)f++;else if(d){j=b[f];e=c[f];for(f++;f<=h&&g[f]===null;)f++;if(f>h)a.lineTo(j,e);else{w=(j+b[f])/2;k=(e+c[f])/2;i=(j+w)/2;m=(e+k)/2;a.quadraticCurveTo(j,e,i,m);i=
(w+b[f])/2;m=(k+c[f])/2;a.quadraticCurveTo(w,k,i,m)}}else{a.lineTo(b[f],c[f]);f++}};a.lineWidth=S;a.lineJoin=qa;for(q=[];g=r[--f];)if((k=g.val.length)>1){var e=[],i=[];for(j=0;j<k;++j){w=0;if(b)for(h=0;h<=f;h++)w=w+r[h].val[j];else w=g.val[j];e.push(z+Math.round(j*(I/(k-1))));i.push(o-Math.round(c*w))}q.push({x:e,y:i,v:r[f].val,nds:f});j--;e.push(z+Math.round(j*(I/(k-1))));i.push(o-Math.round(c*w));for(j=0;g.val[j]===null;)j++;for(h=k-1;g.val[h]===null;)h--;if(j<=h&&$(g.col)){a.beginPath();a.moveTo(e[j],
o);a.lineTo(e[j],i[j]);m(a,e,i,g.val,j,h);a.lineTo(e[h],o);a.closePath();a.fill()}a.strokeStyle=g.col;a.beginPath();a.moveTo(e[j],i[j]);m(a,e,i,g.val,j,h);a.stroke();if(f==0)for(j=0;j<k;++j)aa(j,e[j],F);if(ia){a.fillStyle=g.col;for(j=0;j<k;++j)if(g.val[j]!=void 0){a.beginPath();a.arc(e[j],i[j],ia,0,2*Math.PI);a.closePath();a.fill()}}}},curve:function(a){da.line(a,true)},chart:function(b){var d=y;q=[];if(d){var f,c,g=r[0].len,j=d>1?4:0,h=b?1:d,e=g&&d?(I-j*(g-1))/g/h-1:0,k,i,n,l=z,ca,s,p=b?D?A/D:0:
H?A/H:0;e<0&&(e=0);a.lineWidth=S;a.lineJoin="miter";for(c=0;c<d;c++)q.push({x:[],y:[],v:[],nds:c});for(f=0;f<g;f++){aa(f,l+(e+1)*h/2,F-1);i=o;for(c=0;c<d;c++){k=r[c];n=b?i:o;i=n-Math.round(p*k.val[f]);ca=Math.round(l);s=Math.round(l+e);if(k.val[f]!==null){a.beginPath();a.moveTo(ca,n);a.lineTo(ca,i);a.lineTo(s,i);a.lineTo(s,n);a.closePath();$(k.col)&&a.fill();a.strokeStyle=k.col;a.stroke()}q[c].x.push(0.5+Math.floor(l+e/2));q[c].y.push(i);q[c].v.push(k.val[f]);b||(l=l+(e+1))}l=l+(b?e+1+j:j)}}},pie:function(){var b=
y;q=[];if(b){var d=0,f=[],c=[],g=Math.PI*2,j=[],h=[];if(b>1){for(var e=0,d=b,b=0;b<d;b++)e=e+r[b].sum;if(e)for(b=0;b<d;b++){f[b]=r[b].sum/e*g;c[b]=r[b].col;j.push(r[b].sum);h.push(Math.round(100*r[b].sum/e))}}else{e=r[0];if(e.sum){d=e.len;for(b=0;b<d;b++){f[b]=e.val[b]/e.sum*g;c[b]=P[b%P.length];j.push(e.val[b]);h.push(Math.round(100*e.val[b]/e.sum))}}}var g=z+Math.round(I/2),e=N+Math.round(A/2),i=Math.min(A/2,I/2)-1,m=i+n.fontpx,l,o,s=Math.PI*1.5,v,p,x,u,t=K;ka=i;X=g;Y=e;K=t;a.lineWidth=S;a.lineJoin=
"miter";for(b=0;b<d;b++){v=s+f[b];p=(s+v)/2;q.push({a:s%(2*Math.PI),n:b});if(b===t){l=g+Math.cos(p)*10;o=e+Math.sin(p)*10}else{l=g;o=e}a.beginPath();a.moveTo(l,o);a.arc(l,o,i,s,v,false);a.closePath();$(c[b])&&a.fill();a.strokeStyle=c[b];a.stroke();if(b===t){x=l+m/2*Math.cos(p);u=o+m/2*Math.sin(p)}else aa(j[b],l+m*Math.cos(p),o+m*Math.sin(p),"center","middle");s=v}t!==false&&pa([{x:x,y:u,r:0,v:j[t]+" ("+h[t]+"%)",n:t,nds:0}],true);q.sort(function(a,b){return a.a-b.a})}}},U={line:function(b,d){var f,
c=false,g,e,h=l.linewidth||1,i=[];if(q.length){g=q[0];for(f=0;f<g.x.length;++f)if(g.v[f]!=void 0&&(Math.abs(b-g.x[f])<e||c===false)){e=Math.abs(b-g.x[f]);c=f}if(c!==false){for(f=0;f<q.length;++f){g=q[f];if(g.v[c]!=void 0){if(l.border){a.beginPath();a.lineWidth=h+2;a.arc(g.x[c],g.y[c],l.radius,0,2*Math.PI);if(l.linewidth==0){a.fillStyle=l.border;a.fill()}else{a.strokeStyle=l.border;a.stroke()}}a.beginPath();a.lineWidth=h;a.arc(g.x[c],g.y[c],l.radius,0,2*Math.PI);if(l.linewidth==0){a.fillStyle=l.circle;
a.fill()}else{a.strokeStyle=l.circle;a.stroke()}if(l.axis){a.lineWidth=1;if(/x/i.test(l.axis)){for(d=g.y[c]+l.radius;d<o;){a.moveTo(g.x[c],d);d=d+2;d>o&&(d=o);a.lineTo(g.x[c],d);d=d+2}a.stroke()}if(/y/i.test(l.axis)){for(b=g.x[c]+l.radius;b<J;){a.moveTo(b,g.y[c]);b=b+2;b>J&&(b=J);a.lineTo(b,g.y[c]);b=b+2}a.stroke()}}i.push({x:g.x[c],y:g.y[c],r:h/2+1+l.radius,v:g.v[c],n:c,nds:g.nds})}}pa(i)}}},chart:function(a,d){U.line(a,d)},curve:function(a,d,f){U.line(a,d,f,true)},pie:function(a,d){var f,c=0;if(Math.sqrt(Math.pow(a-
X,2)+Math.pow(d-Y,2))<=ka){f=Math.PI-Math.atan2(Y-d,a-X);for(f=(f+3*Math.PI)%(2*Math.PI);c<q.length&&f>q[c].a;)c++;--c<0&&(c=q.length-1);K=q[c].n;O(true)}else if(K!==false){K=false;O(true)}}};O=function(b){var d=x.split(/:/),f=d[0],c=d[1]||false;a.clearRect(0,0,E,F);if(ga){a.fillStyle=ga;a.fillRect(0,0,E,F)}if(/chart|line|curve/.test(x)){var g,e;a.lineWidth=s.linewidth||1;a.strokeStyle=s.color;if(s.x){d=0;for(g=s.x.length;d<g;++d){e=z+Math.round(I*s.x[d]/100);a.beginPath();a.moveTo(e,N);a.lineTo(e,
o);a.stroke()}}if(s.y){d=0;for(g=s.y.length;d<g;++d){e=o-Math.round(A*s.y[d]/100);a.beginPath();a.moveTo(z,e);a.lineTo(J,e);a.stroke()}}}if(y&&(n.y&&a.font)&&/chart|line|curve/.test(x)){var d=/\:[r|s]/.test(x)?D:H,h,i,k,m=d<10?100:d<100?10:1,q=Math.floor(n.fontpx/2.5);a.font=n.font;a.fillStyle=n.color;a.textAlign="left";g=0;for(e=n.y.length;g<e;++g){h=J+1;i=o-Math.round(A*n.y[g]/100);k=Math.round(m*d*n.y[g]/100)/m;a.fillText(k,h,i+q)}}if(G&&G.z=="top"){da[f](c);na()}else{na();da[f](c)}if(C!==false&&
y>1){a.save();a.font=C.font;k=0;g=L(C.font)+3;e=g-3;h=y;q=3+g*h;i=C.x;for(var u=C.y,d=0;d<h;++d)if((m=a.measureText(r[d].tit)).width>k)k=m.width;m=9+e+k;a.lineWidth=1;if(k=C.background){a.fillStyle=k;a.fillRect(i,u,m,q)}if(k=C.border){a.strokeStyle=k;a.strokeRect(i,u,m,q)}d=0;for(m=u+3;d<h;++d,m=m+g){q=r[d];a.fillStyle=q.col;a.fillRect(i+3,m,e,e);if(k=C.border2){a.strokeStyle=k;a.strokeRect(i+3,m,e,e)}a.textAlign="left";a.textBaseline="top";a.fillStyle=C.color;a.fillText(q.tit,i+6+e,m)}a.restore()}if(!b){v.onmouseover=
v.onmousemove=v.onmouseout=void 0;K=false;if(l){W=a.getImageData(0,0,E,F);if(t)U[f](t.x,t.y,c);v.onmouseover=function(a){t=fa(a)};v.onmousemove=function(b){if(t){f!="pie"&&a.putImageData(W,0,0);t=fa(b);U[f](t.x,t.y,c)}};v.onmouseout=function(){t=void 0;a.putImageData(W,0,0)}}else t=void 0}};n.fontpx=L(n.font);/none|false/.test(s.x)&&(s.x=[]);/none|false/.test(s.y)&&(s.y=[]);z=e[3]+0.5;N=e[0]+0.5;I=Math.max(E-e[1]-e[3],0);A=Math.max(F-e[0]-e[2],0);J=z+I;o=N+A;i.datas&&ma(i.datas);O();return{canvas:v,
data:r,clear:function(){r=[];y=0;return this},load:function(a){ma(a);return this},cls:function(){return this},draw:function(a){a&&(x=a.toLowerCase());O();return this}}},plotter=function(i){return harry(i)};