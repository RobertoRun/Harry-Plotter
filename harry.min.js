// harry plotter 0.8
// ~L~ nikomomo@gmail.com 2009-2012
// https://github.com/nikopol/Harry-Plotter
var harry=function(i){var S="#88a4d7 #d685c9 #86d685 #ffc34f #93c2ea #f28989 #f9eb8a".split(" "),v=function(b,a,h){var c,b=b&&b.constructor==Array&&3==b.length?b:(c=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b))?[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)]:(c=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b))?[2.55*parseFloat(c[1]),2.55*parseFloat(c[2]),2.55*parseFloat(c[3])]:(c=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b))?
[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(c=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b))?[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]:[0,0,0];"array"!=typeof a&&(a=[a,a,a]);for(c=0;3>c;++c)b[c]=Math.max(Math.min(b[c]+a[c],255),0);return void 0!=h?"rgba("+b.join(",")+","+h+")":"rgb("+b.join(",")+")"},O=function(b){var a=b.match(/\d+px/i);return a?parseInt(a,10):(a=b.match(/[0-9\.]+em/i))?Math.floor(16*parseFloat(a,10)):(a=b.match(/\d+pt/i))?Math.floor(1.3333*
parseInt(a,10)):10},fa=function(a){var d=Math.floor(a).toString(),h=parseInt(d.substr(0,1));return h*parseFloat("1E"+(d.length-1))==a?a:(h+1)*parseFloat("1E"+(d.length-1))},P=function(a,d){if("object"==typeof d)for(var h in d)a[h]=d[h];return a},ga=function(a){a=a||window.event;if("offsetX"in a)return{x:a.offsetX,y:a.offsetY};for(var d=a.target,a={x:a.pageX,y:a.pageY};d.offsetParent;)a.x-=d.offsetLeft,a.y-=d.offsetTop,d=d.offsetParent;return a},f;if(i.canvas)f=document.getElementById(i.canvas);else{f=
i.container;var T=i.width||300,Y=i.height||150,U=document.createElement("canvas");U.setAttribute("width",T+"px");U.setAttribute("height",Y+"px");(f?document.getElementById(f):document.body).appendChild(U);f=U}var w=f,G=w.width,H=w.height,a=w.getContext("2d"),Z,ha=i.background,x=i.mode||"line",ia=(i.fill||"a")[0].toLowerCase().replace(/[^nasvhrdl]/,"a"),o=parseFloat(i.opacity,10)||1,V=parseInt(i.linewidth,10)||1,ra=i.linejoin||"miter",ja=parseInt(i.radiuspoint,10)||0,ka=!1===i.autoscale?!1:!0,j=P({color:"#a0a0a0",
font:'normal 9px "Sans Serif"',marks:0,ypos:"right"},i.labels),m=!1===i.mouseover?!1:P({radius:5,linewidth:V,circle:"#888",font:'normal 10px "Sans Serif"',color:"#fff",bullet:"rgba(99,99,99,0.8)",border:"#fff",axis:!1,text:"%v"},i.mouseover),A,n=[],N=!1,la,$,aa;i.margins?f=i.margins:(f=O(j.font),/pie/.test(H.mode)?(f=j.x?2*f:!1===m?0:15,f=[f,f,f,f]):(T=Math.floor(f/2),Y=j.marks,f=[j.y?T:0,j.y&&/right/i.test(j.ypos)?4*f:j.x?f:1,j.x?3+f+Y:j.y?f:1,j.y&&/left/i.test(j.ypos)?4*f:j.x?T:0]));var s=P({color:"#a0a0a0",
x:[0,100],y:[0,25,50,75,100]},i.grid),B=i.title?P({font:'bold 12px "Sans Serif"',color:"rgba(4,4,4,0.3)",x:f[3]+2.5,y:f[0]+2.5,z:"top"},i.title):!1,t=!1===i.legends?!1:P({x:f[3]+2.5,y:f[0]+2.5+(i.title&&!i.title.x?2+O(B.font):0),color:"#666",border2:"#fff",font:'10px "Sans Serif"'},i.legends),r=[],ba,I,y=0,E,z,Q,J,C,K,p,R,ma=function(a){var d,h=a.values||a,c=a.labels||[],g={val:[],lab:[],len:0,sum:0,avg:0,max:0,min:0xffffffffffff,tit:a.title||"dataset#"+(r.length+1),col:a.color||S[r.length%S.length]};
for(d in h){a=parseFloat(h[d],10);g.val.push(h[d]==null?null:a);g.lab.push(c[d]||d);g.sum=g.sum+a;if(a>g.max)g.max=a;if(a<g.min)g.min=a}g.len=g.val.length;g.avg=g.len?g.sum/g.len:0;r.push(g);y=r.length;if(y==1){ba=g.min;E=I=ka?fa(g.max):g.max}else{ba=Math.min(g.min,ba);I=Math.max(g.max,I);d=E=0;for(h=r[0].val.length;d<h;++d){for(a=c=0;a<r.length;++a)c=c+(r[a].val[d]||0);c>E&&(E=ka?fa(c):c)}}},na=function(a){if(a instanceof Array&&typeof a[0]=="object")for(var d=0,h=a.length;d<h;++d)ma(a[d]);else ma(a)},
ca=function(b){var d,h;if(ia=="a"){o=1;h=/\:river/.test(x)?"v":/line/.test(x)||/curve/.test(x)?y>1?"n":"v":/chart/.test(x)?y>1?"s":"v":/pie/.test(x.test)?"r":"s"}else h=ia;switch(h){case "s":d=v(b,0,o);break;case "l":d=v(b,21,o);break;case "d":d=v(b,-21,o);break;case "v":d=a.createLinearGradient(0,p,0,Q);d.addColorStop(0,v(b,-48,o));d.addColorStop(1,v(b,48,o));break;case "h":d=a.createLinearGradient(z,0,K,0);d.addColorStop(0,v(b,-48,o));d.addColorStop(1,v(b,48,o));break;case "r":d=a.createRadialGradient(K,
p,0,z,p,1);d.addColorStop(1,v(b,-48,o));d.addColorStop(0,v(b,48,o))}return d?a.fillStyle=d:false},L=function(b){if(b&&a.hasOwnProperty("shadowBlur")){b=b.split(/[ ,;:-]/);a.shadowOffsetX=parseInt(b[0]||1,10);a.shadowOffsetY=parseInt(b[1]||1,10);a.shadowBlur=parseInt(b[2]||1,10);a.shadowColor=b[3]||"#000"}},M=function(){if(a.hasOwnProperty("clearShadow"))a.clearShadow();else if(a.hasOwnProperty("shadowBlur")){a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.shadowColor="rgba(0,0,0,0)"}},oa=function(){if(B){L(B.shadow);
a.font=B.font;a.textAlign="left";a.textBaseline="top";a.fillStyle=B.color;a.fillText(B.text,B.x,B.y);M()}},da=function(b,d,h,c,g){if(j.x&&b%j.x==0){b=r[0].lab[b]||b;L(j.shadow);a.font=j.font;a.fillStyle=j.color;a.textAlign=c||"center";a.textBaseline=g||"alphabetic";a.fillText(b,d,h);M()}if(j.marks){a.save();a.lineWidth=1;a.moveTo(d,p);a.lineTo(d,p+j.marks);a.strokeStyle=j.color;a.stroke();a.restore()}},qa=function(b,d){a.save();a.font=m.font;var h,c,g,k=b.length,e,u,l=0,D=0,W=O(m.font),j=W/2,f=W+
3,i,q,n=G;q=0;i=H;var pa=0;b.sort(function(a,b){return parseInt(b.v,10)-parseInt(a.v,10)});for(c=0;c<k;c++){e=b[c];g=r[e.nds].lab[e.n];u=r[e.nds].tit;if(g=typeof m.text=="function"?m.text(e.n,e.v,g,e.x,e.y):m.text.replace("%v",e.v).replace("%l",g).replace("%n",e.n).replace("%t",u)){e.lines=g.split(/\n|\\n/);e.h=e.lines.length*f;e.h2=Math.floor(e.h/2);e.w=0;for(h in e.lines)if((g=a.measureText(e.lines[h]).width+6)>e.w)e.w=g;if(e.w>D)D=e.w;l=l+e.h;e.r++;n>e.x-e.r&&(n=e.x-e.r);q<e.x+e.r&&(q=e.x+e.r);
if(i>e.y)i=e.y;if(pa<e.y)pa=e.y}}k>1&&(D=D+(6+W));if(l){l=l+3;if(d){q=n+(q-n)/2-D/2;q+D>G&&(q=G-1-D)}else q+D>=G&&(q=n-D);q<1&&(q=1);q=Math.floor(q)+0.5;h=q+D;c=i+l/2+l/2;c>p&&(c=p-1);c=Math.floor(c)+0.5;e=c-l;a.beginPath();a.moveTo(q,c);a.lineTo(h,c);a.lineTo(h,e);a.lineTo(q,e);a.closePath();L(m.shadowbox);a.fillStyle=m.bullet;a.fill();M();a.lineWidth=1;a.lineJoin="round";a.strokeStyle=m.border;a.stroke();a.textAlign="left";a.textBaseline="top";i=e+3;for(c=0;c<k;c++){e=b[c];l=q+3;if(k>1){a.beginPath();
a.arc(l+j,i+j,j,0,2*Math.PI);a.fillStyle=r[e.nds].col;a.fill();l=l+(W+3)}L(m.shadow);a.fillStyle=m.color;for(h=0;h<e.lines.length;++h,i=i+f)a.fillText(e.lines[h],l,i);M()}}a.restore()},ea={line:function(b,d){var h=y,c=b?E?C/E:0:I?C/I:0,g,k,e,u,l,i=function(a,b,c,g,e,h){for(var k,j,u,l,f,i;e<=h;)if(g[e]===null)e++;else if(d){k=b[e];j=c[e];for(e++;e<=h&&g[e]===null;)e++;if(e>h)a.lineTo(k,j);else{u=(k+b[e])/2;l=(j+c[e])/2;f=(k+u)/2;i=(j+l)/2;a.quadraticCurveTo(k,j,f,i);f=(u+b[e])/2;i=(l+c[e])/2;a.quadraticCurveTo(u,
l,f,i)}}else{a.lineTo(b[e],c[e]);e++}};a.lineWidth=V;a.lineJoin=ra;for(n=[];g=r[--h];)if((l=g.val.length)>1){var j=[],f=[];for(k=0;k<l;++k){u=0;if(b)for(e=0;e<=h;e++)u=u+r[e].val[k];else u=g.val[k];j.push(z+Math.round(k*(J/(l-1))));f.push(p-Math.round(c*u))}n.push({x:j,y:f,v:r[h].val,nds:h});k--;j.push(z+Math.round(k*(J/(l-1))));f.push(p-Math.round(c*u));for(k=0;g.val[k]===null;)k++;for(e=l-1;g.val[e]===null;)e--;if(k<=e&&ca(g.col)){a.beginPath();a.moveTo(j[k],p);a.lineTo(j[k],f[k]);i(a,j,f,g.val,
k,e);a.lineTo(j[e],p);a.closePath();a.fill()}a.strokeStyle=g.col;a.beginPath();a.moveTo(j[k],f[k]);i(a,j,f,g.val,k,e);a.stroke();if(h==0)for(k=0;k<l;++k)da(k,j[k],H-1);if(ja){a.fillStyle=g.col;for(k=0;k<l;++k)if(g.val[k]!=void 0){a.beginPath();a.arc(j[k],f[k],ja,0,2*Math.PI);a.closePath();a.fill()}}}},curve:function(a){ea.line(a,true)},chart:function(b){var d=y;n=[];if(d){var h,c,g=r[0].len,k=d>1?4:0,e=b?1:d,j=g&&d?(J-k*(g-1))/g/e-1:0,l,f,i,m=z,F,s,q=b?E?C/E:0:I?C/I:0;j<0&&(j=0);a.lineWidth=V;a.lineJoin=
"miter";for(c=0;c<d;c++)n.push({x:[],y:[],v:[],nds:c});for(h=0;h<g;h++){da(h,m+(j+1)*e/2,H-1);f=p;for(c=0;c<d;c++){l=r[c];i=b?f:p;f=i-Math.round(q*l.val[h]);F=Math.round(m);s=Math.round(m+j);if(l.val[h]!==null){a.beginPath();a.moveTo(F,i);a.lineTo(F,f);a.lineTo(s,f);a.lineTo(s,i);a.closePath();ca(l.col)&&a.fill();a.strokeStyle=l.col;a.stroke()}n[c].x.push(0.5+Math.floor(m+j/2));n[c].y.push(f);n[c].v.push(l.val[h]);b||(m=m+(j+1))}m=m+(b?j+1+k:k)}}},pie:function(){var b=y;n=[];if(b){var d=0,h=[],c=
[],g=Math.PI*2,k=[],e=[];if(b>1){for(var f=0,d=b,b=0;b<d;b++)f=f+r[b].sum;if(f)for(b=0;b<d;b++){h[b]=r[b].sum/f*g;c[b]=r[b].col;k.push(r[b].sum);e.push(Math.round(100*r[b].sum/f))}}else{f=r[0];if(f.sum){d=f.len;for(b=0;b<d;b++){h[b]=f.val[b]/f.sum*g;c[b]=S[b%S.length];k.push(f.val[b]);e.push(Math.round(100*f.val[b]/f.sum))}}}var g=z+Math.round(J/2),f=Q+Math.round(C/2),i=Math.min(C/2,J/2)-1,m=i+j.fontpx,p,s,F=Math.PI*1.5,t,q,w,x,o=N;la=i;$=g;aa=f;N=o;a.lineWidth=V;a.lineJoin="miter";for(b=0;b<d;b++){t=
F+h[b];q=(F+t)/2;n.push({a:F%(2*Math.PI),n:b});if(b===o){p=g+Math.cos(q)*10;s=f+Math.sin(q)*10}else{p=g;s=f}a.beginPath();a.moveTo(p,s);a.arc(p,s,i,F,t,false);a.closePath();ca(c[b])&&a.fill();a.strokeStyle=c[b];a.stroke();if(b===o){w=p+m/2*Math.cos(q);x=s+m/2*Math.sin(q)}else da(k[b],p+m*Math.cos(q),s+m*Math.sin(q),"center","middle");F=t}o!==false&&qa([{x:w,y:x,r:0,v:k[o]+" ("+e[o]+"%)",n:o,nds:0}],true);n.sort(function(a,b){return a.a-b.a})}}},X={line:function(b,d){var h,c=false,g,f,e=m.linewidth||
1,j=[];if(n.length){g=n[0];for(h=0;h<g.x.length;++h)if(g.v[h]!=void 0&&(Math.abs(b-g.x[h])<f||c===false)){f=Math.abs(b-g.x[h]);c=h}if(c!==false){for(h=0;h<n.length;++h){g=n[h];if(g.v[c]!=void 0){if(m.border){a.beginPath();a.lineWidth=e+2;a.arc(g.x[c],g.y[c],m.radius,0,2*Math.PI);if(m.linewidth==0){a.fillStyle=m.border;a.fill()}else{a.strokeStyle=m.border;a.stroke()}}a.beginPath();a.lineWidth=e;a.arc(g.x[c],g.y[c],m.radius,0,2*Math.PI);if(m.linewidth==0){a.fillStyle=m.circle;a.fill()}else{a.strokeStyle=
m.circle;a.stroke()}if(m.axis){a.lineWidth=1;if(/x/i.test(m.axis)){for(d=g.y[c]+m.radius;d<p;){a.moveTo(g.x[c],d);d=d+2;d>p&&(d=p);a.lineTo(g.x[c],d);d=d+2}a.stroke()}if(/y/i.test(m.axis)){for(b=g.x[c]+m.radius;b<K;){a.moveTo(b,g.y[c]);b=b+2;b>K&&(b=K);a.lineTo(b,g.y[c]);b=b+2}a.stroke()}}j.push({x:g.x[c],y:g.y[c],r:e/2+1+m.radius,v:g.v[c],n:c,nds:g.nds})}}qa(j)}}},chart:function(a,d){X.line(a,d)},curve:function(a,d,h){X.line(a,d,h,true)},pie:function(a,d){var h,c=0;if(Math.sqrt(Math.pow(a-$,2)+Math.pow(d-
aa,2))<=la){h=Math.PI-Math.atan2(aa-d,a-$);for(h=(h+3*Math.PI)%(2*Math.PI);c<n.length&&h>n[c].a;)c++;--c<0&&(c=n.length-1);N=n[c].n;R(true)}else if(N!==false){N=false;R(true)}}};R=function(b){var d=x.split(/:/),h=d[0],c=d[1]||false;a.clearRect(0,0,G,H);if(ha){a.fillStyle=ha;a.fillRect(0,0,G,H)}if(/chart|line|curve/.test(x)){var g,f;a.lineWidth=s.linewidth||1;a.strokeStyle=s.color;if(s.x){d=0;for(g=s.x.length;d<g;++d){f=z+Math.round(J*s.x[d]/100);a.beginPath();a.moveTo(f,Q);a.lineTo(f,p);a.stroke()}}if(s.y){d=
0;for(g=s.y.length;d<g;++d){f=p-Math.round(C*s.y[d]/100);a.beginPath();a.moveTo(z,f);a.lineTo(K,f);a.stroke()}}}if(y&&j.y&&/chart|line|curve/.test(x)){var d=/\:[r|s]/.test(x)?E:I,e,i,l,n=d<10?100:d<100?10:1,o=Math.floor(j.fontpx/2.5);L(j.shadow);a.font=j.font;a.fillStyle=j.color;g=0;for(f=j.y.length;g<f;++g){i=p-Math.round(C*j.y[g]/100);l=Math.round(n*d*j.y[g]/100)/n;if(/left/i.test(j.ypos)){e=K+1;a.textAlign="left";a.fillText(l,e,i+o)}if(/right/i.test(j.ypos)){e=z-2;a.textAlign="right";a.fillText(l,
e,i+o)}}M()}if(B&&B.z=="top"){ea[h](c);oa()}else{oa();ea[h](c)}if(t!==false&&y>1){a.save();a.font=t.font;l=0;g=O(t.font)+3;f=g-3;e=y;o=3+g*e;i=t.x;for(var v=t.y,d=0;d<e;++d)if((n=a.measureText(r[d].tit)).width>l)l=n.width;n=9+f+l;a.lineWidth=1;if(l=t.background){L(t.shadowbox);a.fillStyle=l;a.fillRect(i,v,n,o);M()}if(l=t.border){a.strokeStyle=l;a.strokeRect(i,v,n,o)}d=0;for(n=v+3;d<e;++d,n=n+g){o=r[d];L(t.shadow);a.fillStyle=o.col;a.fillRect(i+3,n,f,f);M();if(l=t.border2){a.strokeStyle=l;a.strokeRect(i+
3,n,f,f)}L(t.shadow);a.textAlign="left";a.textBaseline="top";a.fillStyle=t.color;a.fillText(o.tit,i+6+f,n);M()}a.restore()}if(!b){w.onmouseover=w.onmousemove=w.onmouseout=void 0;N=false;if(m){Z=a.getImageData(0,0,G,H);if(A)X[h](A.x,A.y,c);w.onmouseover=function(a){A=ga(a)};w.onmousemove=function(b){if(A){h!="pie"&&a.putImageData(Z,0,0);A=ga(b);X[h](A.x,A.y,c)}};w.onmouseout=function(){A=void 0;a.putImageData(Z,0,0)}}else A=void 0}};j.fontpx=O(j.font);/none|false/.test(s.x)&&(s.x=[]);/none|false/.test(s.y)&&
(s.y=[]);z=f[3]+0.5;Q=f[0]+0.5;J=Math.max(G-f[1]-f[3],0);C=Math.max(H-f[0]-f[2],0);K=z+J;p=Q+C;i.datas&&na(i.datas);R();return{canvas:w,data:r,clear:function(){r=[];y=0;return this},load:function(a){na(a);return this},cls:function(){return this},draw:function(a){a&&(x=a.toLowerCase());R();return this}}},plotter=function(i){return harry(i)};