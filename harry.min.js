// harry plotter 0.9
// ~L~ nikomomo@gmail.com 2009-2013
// https://github.com/nikopol/Harry-Plotter
var harry=function(h){var aa="#88a4d7 #d685c9 #86d685 #ffc34f #93c2ea #f28989 #f9eb8a".split(" "),I=function(e,a,f){var c;e=e&&e.constructor==Array&&3==e.length?e:(c=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))?[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)]:(c=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))?[2.55*parseFloat(c[1]),2.55*parseFloat(c[2]),2.55*parseFloat(c[3])]:(c=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(c=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))?[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]:[0,0,0];"array"!=typeof a&&(a=[a,a,a]);for(c=0;3>c;++c)e[c]=Math.max(Math.min(e[c]+a[c],255),0);return void 0!=f?"rgba("+e.join(",")+","+f+")":"rgb("+e.join(",")+")"},U=function(e){var a=e.match(/\d+px/i);return a?parseInt(a,10):(a=e.match(/[0-9\.]+em/i))?Math.floor(16*parseFloat(a)):(a=e.match(/\d+pt/i))?Math.floor(1.3333*
parseInt(a,10)):10},oa=function(a){var b=Math.floor(a).toString(),f=parseInt(b.substr(0,1),10);return f*parseFloat("1E"+(b.length-1))==a?a:(f+1)*parseFloat("1E"+(b.length-1))},Z=function(a,b){if("object"==typeof b)for(var f in b)a[f]=b[f];return a},pa=function(a){a=a||window.event;if("offsetX"in a)return{x:a.offsetX,y:a.offsetY};var b=a.target;for(a={x:a.pageX,y:a.pageY};b.offsetParent;)a.x-=b.offsetLeft,a.y-=b.offsetTop,b=b.offsetParent;return a},qa=function(a){var b={};for(a=(a||"line").split(":");a.length;)b[a.pop()]=
!0;return b},ha=function(a,b){return b?Math.round(1E3*a/b)/10+"%":"0%"},ra=function(a,b,f,c,g){var d;g||(g={});c||(c=0);var k=g,n,j="";if(b&&(j="function"==typeof b?b(f):b,f))for(n in f)j=j.replace("%"+n,f[n]);k.lines=j.split(/\n|\\n/);g.lh=U(a.font)+c;g.h=g.lines.length*g.lh;g.w=0;for(d in g.lines)if((b=a.measureText(g.lines[d]).width+2*c)>g.w)g.w=b;return g},S;if(h.canvas)S=document.getElementById(h.canvas);else a:{var O=h.container,Ca=h.width||300,Da=h.height||150;S=document.createElement("canvas");
S.setAttribute("width",Ca+"px");S.setAttribute("height",Da+"px");if(O){if(O="string"==typeof O?document.getElementById(O):O,!O){S=void 0;break a}}else O=document.body;O.appendChild(S)}var F=S,P=F.width,$=F.height,a=F.getContext("2d"),ia,sa=h.background,r=qa(h.mode),V=(h.mode||"line").split(":")[0],Ea=(h.fill||"s")[0].toLowerCase().replace(/[^nsvhrdl]/g,"s"),J=parseFloat(h.opacity)||1,ba=parseInt(h.linewidth,10)||1,Fa=h.linejoin||"miter",ta=void 0==h.barspace?"a":parseInt(h.barspace,10),ua=parseInt(h.radiuspoint,
10)||0,va=h.autoscale&&/top/i.test(h.autoscale),ja=h.autoscale&&/bot/i.test(h.autoscale),j=Z({color:"#a0a0a0",font:'normal 9px "Sans Serif"',marks:0,xwidth:0,ywidth:0,ypos:"right"},h.labels),l=!1===h.mouseover?!1:Z({radius:5,linewidth:2*ba,circle:"#888",font:'normal 10px "Sans Serif"',color:"#fff",bullet:"rgba(99,99,99,0.8)",axis:!1,text:"%v"},h.mouseover),G,q=[],W=!1,wa,ka,la,Ga=h.margins?!1:!0,w=h.margins||[0,0,0,0],v=Z({color:"#a0a0a0",x:[0,100],y:[0,25,50,75,100]},h.grid),y=h.title?Z({font:'bold 12px "Sans Serif"',
color:"rgba(4,4,4,0.5)",z:"top"},h.title):!1,x=!1===h.legends?!1:Z({color:"#666",font:'10px "Sans Serif"',layout:"v"},h.legends),s=[],T,B,u=0,K,L,X,z,H,C,D,Q,t,ca,A=1,Y,da=function(){var e,b,f,c;u=s.length;T=B=!1;L=K=X=0;j.xwidth=0;a.font=j.font;if(u){for(e=0;e<u;e++)b=s[e],T=!1===T?b.min:Math.min(b.min,T),B=!1===B?b.max:Math.max(b.max,B),b.maxlab&&(j.xwidth=Math.max(j.xwidth,a.measureText(b.maxlab).width));va&&(B=oa(B));if(r.stack){e=0;for(f=s[0].len;e<f;++e){for(b=c=0;b<u;++b)c+=s[b].val[e]||0;
c>K&&(K=va?oa(c):c)}L=ja?K-T:K}else K=B,L=ja?B-T:B;X=ja?T:0;j.ywidth=a.measureText(K||"0").width}j.fontpx=U(j.font);"auto"==j.x&&(j.x=1,j.xauto=!0);/none|false/.test(v.x)&&(v.x=[]);/none|false/.test(v.y)&&(v.y=[]);if(Ga)if(e=r,b=U(j.font),e.pie)b=j.x?2*b:!1===l?0:15,w=[b,b,b,b];else{f=/^l/i.test(j.ypos);c=Math.floor(b/2);var g=j.marks;w=e.vertical?[j.y&&f?b+4:j.x?b:1,j.y?b:1,j.y&&!f?b+4:j.x?b:1,j.x?4+j.xwidth:j.y?b:1]:[j.y?c:1,j.y&&!f?4+j.ywidth:j.x?b:1,j.x?3+b+g:j.y?b:1,j.y&&f?4+j.ywidth:j.x?c:1]}z=
w[3];H=w[0];C=Math.max(P-w[1]-w[3],0);D=Math.max($-w[0]-w[2],0);Q=z+C;t=H+D},xa=function(a){var b,f=a.values||a,c=a.labels||[],g,d={val:[],lab:[],len:0,sum:0,avg:0,max:0,min:0xffffffffffff,tit:a.title||"dataset#"+(s.length+1),maxlab:"",col:a.color||aa[s.length%aa.length]};for(b in f)a=parseFloat(f[b]),isNaN(a)&&(a=null),d.val.push(a),g=c[b]||b,g.length>d.maxlab.length&&(d.maxlab=g),d.lab.push(g),d.sum+=a,a>d.max&&(d.max=a),a&&a<d.min&&(d.min=a);d.len=d.val.length;d.avg=d.len?d.sum/d.len:0;s.push(d)},
ya=function(a){if(a instanceof Array&&"object"==typeof a[0])for(var b=0,f=a.length;b<f;++b)xa(a[b]);else xa(a);da()},ea=function(e){var b;switch(Ea){case "s":b=I(e,0,J);break;case "l":b=I(e,21,J);break;case "d":b=I(e,-21,J);break;case "v":b=a.createLinearGradient(0,t,0,H);b.addColorStop(0,I(e,-48,J));b.addColorStop(1,I(e,48,J));break;case "h":b=a.createLinearGradient(z,0,Q,0);b.addColorStop(0,I(e,-48,J));b.addColorStop(1,I(e,48,J));break;case "r":b=z+C/2;var f=H+D/2;b=a.createRadialGradient(b,f,0,
b,f,D/2);b.addColorStop(0,I(e,-48,J));b.addColorStop(1,I(e,48,J))}return b?a.fillStyle=b:!1},M=function(e){e&&a.hasOwnProperty("shadowBlur")&&(e=e.split(/[ ,;:-]/),a.shadowOffsetX=parseInt(e[0]||1,10),a.shadowOffsetY=parseInt(e[1]||1,10),a.shadowBlur=parseInt(e[2]||1,10),a.shadowColor=e[3]||"#000")},N=function(){a.hasOwnProperty("clearShadow")?a.clearShadow():a.hasOwnProperty("shadowBlur")&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},za=function(){y&&(M(y.shadow),a.font=y.font,a.textAlign=
"left",a.textBaseline="top",a.fillStyle=y.color,a.fillText(y.text,void 0==y.x?w[3]+2:y.x,void 0==y.y?w[0]+2:y.y),N())},fa=function(e,b,f,c,g,d){a.save();b=Math.round(b);f=Math.round(f);if(j.x&&0==e%j.x){var k=!0;e=s[0].lab[e]||e;var n=0;a.font=j.font;j.xauto&&d&&(n=a.measureText(e).width,k=!("h"==d&&"center"==c&&b-n/2<ca||"v"==d&&f<ca));k&&(M(j.shadow),a.fillStyle=j.color,a.textAlign=c,a.textBaseline=g,a.fillText(e,b,f),N(),ca="center"==c?b+n/2:f+j.fontpx)}j.marks&&(a.lineWidth=1,a.beginPath(),a.moveTo(b,
t),a.lineTo(b,t+j.marks),a.strokeStyle=j.color,a.stroke());a.restore()},Aa=function(e,b){a.save();a.font=l.font;var f,c,g=e.length,d,k=f=0,n=U(l.font),j=Math.floor(n/2),E=n+3,m,p,h=P;p=0;m=$;var r=0,u=0,q,R;l.sort&&e.sort(function(a,b){return parseFloat(b.v)-parseFloat(a.v)});for(c=0;c<g;c++)u+=e[c].v;for(c=0;c<g;c++)d=e[c],q={v:d.v,l:s[d.nds].lab[d.n],n:d.n,t:s[d.nds].tit,p:d.pct||ha(d.v,u)},d=ra(a,l.text,q,3,d),d.w&&(d.h2=Math.floor(d.h/2),d.w>k&&(k=d.w),f+=d.h,d.r++,h>d.x-d.r&&(h=d.x-d.r),p<d.x+
d.r&&(p=d.x+d.r),m>d.y&&(m=d.y),r<d.y&&(r=d.y));1<g&&(k+=6+n);if(f){l.header&&(l.header.font&&(a.font=l.header.font),R=ra(a,l.header.text,q,3),R.w>k&&(k=R.w),f+=R.h);f+=3;b?(p=h+(p-h)/2-k/2,p+k>P&&(p=P-1-k)):p+k>=P&&(p=h-k);1>p&&(p=1);p=Math.floor(p);c=p+k;d=m+f/2+f/2;d>t&&(d=t-1);d=Math.floor(d);f=d-f;a.beginPath();a.moveTo(p,d);a.lineTo(c,d);a.lineTo(c,f);a.lineTo(p,f);a.closePath();l.bullet&&(M(l.shadowbox),a.strokStyle="",a.fillStyle=l.bullet,a.fill(),N());l.border&&(a.lineWidth=1,a.lineJoin=
"round",a.strokeStyle=l.border,a.stroke());a.textAlign="left";a.textBaseline="top";k=f+3;if(R){m=p+3;M(l.header.shadow);a.fillStyle=l.header.color||l.color;for(f=0;f<R.lines.length;++f,k+=R.lh)a.fillText(R.lines[f],m,k);N();a.font=l.font}for(c=0;c<g;c++){d=e[c];m=p+3;1<g&&(a.beginPath(),a.arc(m+j,k+j,j,0,2*Math.PI),a.fillStyle=s[d.nds].col,a.fill(),m+=n+3);M(l.shadow);a.fillStyle=l.color;for(f=0;f<d.lines.length;++f,k+=E)a.fillText(d.lines[f],m,k);N()}}a.restore()},ma={line:function(){var e=u,b=L?
D/L:0,f,c,g,d,k,n="curve"==V,h=t+j.marks+2,l=function(a,b,c,e,d,f){for(var g,k,j,m,p,h;d<=f;)if(null===e[d])d++;else if(n){g=b[d];k=c[d];for(d++;d<=f&&null===e[d];)d++;d>f?a.lineTo(g,k):(j=(g+b[d])/2,m=(k+c[d])/2,p=(g+j)/2,h=(k+m)/2,a.quadraticCurveTo(g,k,p,h),p=(j+b[d])/2,h=(m+c[d])/2,a.quadraticCurveTo(j,m,p,h))}else a.lineTo(b[d],c[d]),d++};a.lineWidth=ba;a.lineJoin=Fa;for(q=[];f=s[--e];)if(1<(k=f.len)){var m=[],p=[];for(c=0;c<k;++c){d=0;if(r.stack)for(g=0;g<=e;g++)d+=s[g].val[c]-X;else d=f.val[c]-
X;m.push(z+Math.round(c*(C/(k-1))));p.push(t-Math.round(b*d*A))}q.push({x:m,y:p,v:s[e].val,nds:e});c--;m.push(z+Math.round(c*(C/(k-1))));p.push(t-Math.round(b*d));for(c=0;null===f.val[c];)c++;for(g=k-1;null===f.val[g];)g--;c<=g&&ea(f.col)&&(a.beginPath(),a.moveTo(m[c],t),a.lineTo(m[c],p[c]),l(a,m,p,f.val,c,g),a.lineTo(m[g],t),a.closePath(),a.fill());a.strokeStyle=f.col;a.beginPath();a.moveTo(m[c],p[c]);l(a,m,p,f.val,c,g);a.stroke();if(0==e)for(c=0;c<k;++c)fa(c,m[c],h,"center","top","h");if(ua){a.fillStyle=
f.col;for(c=0;c<k;++c)void 0!=f.val[c]&&(a.beginPath(),a.arc(m[c],p[c],ua,0,2*Math.PI),a.closePath(),a.fill())}}},curve:function(){ma.line()},chart:function(){q=[];if(u){var e,b,f=s[0].len,c="a"==ta?1<u?4:0:ta,g=r.stack?1:u,d=r.vertical?D:C,d=f&&u?(d-c*(f-1))/f/g-1:0,k,n=H,h,l=z,m,p;e=r.vertical?C:D;var x=t+j.marks+2,v=r.stack?K?e/K:0:B?e/B:0;0>d&&(d=0);a.lineWidth=ba;a.lineJoin="miter";for(b=0;b<u;b++)q.push({x:[],y:[],v:[],nds:b});if(r.vertical)for(e=0;e<f;e++){fa(e,z-j.marks-2,n,"right","top",
"v");l=z;for(b=0;b<u;b++)k=s[b],m=r.stack?l:z,l=m+Math.round(v*k.val[e]*A),h=Math.round(n),g=Math.round(n+d),null!==k.val[e]&&(a.beginPath(),a.moveTo(m,h),a.lineTo(m,g),a.lineTo(l,g),a.lineTo(l,h),a.closePath(),ea(k.col)&&a.fill(),a.strokeStyle=k.col,a.stroke()),q[b].x.push(l),q[b].y.push(Math.floor(n+d/2)),q[b].v.push(k.val[e]),r.stack||(n+=d+1);n+=r.stack?d+1+c:c}else for(e=0;e<f;e++){fa(e,l+(d+1)*g/2,x,"center","top","h");n=t;for(b=0;b<u;b++)k=s[b],h=r.stack?n:t,n=h-Math.round(v*k.val[e]*A),m=
Math.round(l),p=Math.round(l+d),null!==k.val[e]&&(a.beginPath(),a.moveTo(m,h),a.lineTo(m,n),a.lineTo(p,n),a.lineTo(p,h),a.closePath(),ea(k.col)&&a.fill(),a.strokeStyle=k.col,a.stroke()),q[b].x.push(Math.floor(l+d/2)),q[b].y.push(n),q[b].v.push(k.val[e]),r.stack||(l+=d+1);l+=r.stack?d+1+c:c}}},pie:function(){q=[];if(u){var e,b=0,f=[],c=[],g=2*Math.PI,d=[],k=[];if(1<u){var n=0;for(e=0;e<u;e++)n+=s[e].sum;if(n){e=0;for(b=u;e<u;e++)f[e]=A*s[e].sum/n*g,c[e]=s[e].col,d.push(s[e].sum),k.push(ha(s[e].sum,
n))}}else if(n=s[0],n.sum){b=n.len;for(e=0;e<b;e++)f[e]=A*n.val[e]/n.sum*g,c[e]=aa[e%aa.length],d.push(n.val[e]),k.push(ha(n.val[e],n.sum))}var g=z+Math.round(C/2),n=H+Math.round(D/2),l=Math.min(D/2,C/2)-1,h=l+j.fontpx,m,p,r=1.5*Math.PI,t,v,x,y,w=W;wa=l;ka=g;la=n;W=w;a.lineWidth=ba;a.lineJoin="miter";for(e=0;e<b;e++)t=r+f[e],v=(r+t)/2,q.push({a:r%(2*Math.PI),n:e}),e===w?(m=g+10*Math.cos(v),p=n+10*Math.sin(v)):(m=g,p=n),a.beginPath(),a.moveTo(m,p),a.arc(m,p,l,r,t,!1),a.closePath(),ea(c[e])&&a.fill(),
a.strokeStyle=c[e],a.stroke(),e===w?(x=m+h/2*Math.cos(v),y=p+h/2*Math.sin(v)):fa(d[e],m+h*Math.cos(v),p+h*Math.sin(v),"center","middle"),r=t;!1!==w&&Aa([{x:x,y:y,r:0,v:d[w],pct:k[w],n:w,nds:1<u?w:0}],!0);q.sort(function(a,b){return a.a-b.a})}}},ga={line:function(e,b){var f,c=!1,g,d,k,j=l.linewidth||1,h=[];if(q.length){g=q[0];for(f=0;f<g.x.length;++f)if(void 0!=g.v[f]&&(k=r.vertical?Math.abs(b-g.y[f]):Math.abs(e-g.x[f]),!1===c||k<d))d=k,c=f;if(!1!==c){for(f=0;f<q.length;++f)if(g=q[f],void 0!=g.v[c]){l.border2&&
(a.beginPath(),a.lineWidth=j+2,a.arc(g.x[c],g.y[c],l.radius,0,2*Math.PI),0==l.linewidth?(a.fillStyle=l.border2,a.fill()):(a.strokeStyle=l.border2,a.stroke()));a.beginPath();a.lineWidth=j;a.arc(g.x[c],g.y[c],l.radius,0,2*Math.PI);0==l.linewidth?(a.fillStyle=l.circle,a.fill()):(a.strokeStyle=l.circle,a.stroke());if(l.axis){a.lineWidth=1;if(/x/i.test(l.axis)){for(d=g.y[c]+l.radius;d<t;)a.moveTo(g.x[c],d),d+=2,d>t&&(d=t),a.lineTo(g.x[c],d),d+=2;a.stroke()}if(/y/i.test(l.axis)){for(e=g.x[c]+l.radius;e<
Q;)a.moveTo(e,g.y[c]),e+=2,e>Q&&(e=Q),a.lineTo(e,g.y[c]),e+=2;a.stroke()}}h.push({x:g.x[c],y:g.y[c],r:j/2+1+l.radius,v:g.v[c],n:c,nds:g.nds})}Aa(h)}}},chart:function(a,b){ga.line(a,b)},curve:function(a,b){ga.line(a,b)},pie:function(a,b){var f,c=0;if(Math.sqrt(Math.pow(a-ka,2)+Math.pow(b-la,2))<=wa){f=Math.PI-Math.atan2(la-b,a-ka);for(f=(f+3*Math.PI)%(2*Math.PI);c<q.length&&f>q[c].a;)c++;0>--c&&(c=q.length-1);W=q[c].n;Y(!0)}else!1!==W&&(W=!1,Y(!0))}};Y=function(e){ca=-1;a.clearRect(-1,-1,P+1,$+1);
sa&&(a.fillStyle=sa,a.fillRect(-1,-1,P+1,$+1));if(!r.pie){var b,f,c;a.lineWidth=v.linewidth||1;a.strokeStyle=v.color;if(v.x){b=0;for(f=v.x.length;b<f;++b)a.beginPath(),r.vertical?(c=H+Math.round(D*v.x[b]/100),a.moveTo(z,c),a.lineTo(Q,c)):(c=z+Math.round(C*v.x[b]/100),a.moveTo(c,H),a.lineTo(c,t)),a.stroke()}if(v.y){b=0;for(f=v.y.length;b<f;++b)a.beginPath(),r.vertical?(c=z+Math.round(C*v.y[b]/100),a.moveTo(c,H),a.lineTo(c,t)):(c=t-Math.round(D*v.y[b]/100),a.moveTo(z,c),a.lineTo(Q,c)),a.stroke()}}if(u&&
j.y&&!r.pie){var g,d,k=10>L?100:100>L?10:1;M(j.shadow);a.font=j.font;a.fillStyle=j.color;if(r.vertical){a.textAlign="center";b=0;for(f=j.y.length;b<f;++b)c=z+Math.round(C*j.y[b]/100),d=X+L*j.y[b]/100,d=Math.round(k*d)/k,/r/i.test(j.ypos)&&(g=t+1,a.textBaseline="top",a.fillText(d,c,g)),/l/i.test(j.ypos)&&(g=H-2,a.textBaseline="bottom",a.fillText(d,c,g))}else{a.textBaseline="middle";b=0;for(f=j.y.length;b<f;++b)g=t-Math.round(D*j.y[b]/100),d=X+L*j.y[b]/100,d=Math.round(k*d)/k,/r/i.test(j.ypos)&&(c=
Q+1,a.textAlign="left",a.fillText(d,c,g)),/l/i.test(j.ypos)&&(c=z-2,a.textAlign="right",a.fillText(d,c,g))}N()}y&&"top"==y.z?(ma[V](),za()):(za(),ma[V]());if(!1!==x&&1<u){a.save();a.font=x.font;var h,q,E,m;f=[];c="h"==x.layout;var p=q=0;g=U(x.font)+3;d=u;var k=g-3,B=6+k;m=c?3+g:3+g*d;E=void 0!=x.x?x.x:w[3]+2;var A=void 0!=x.y?x.y:w[0]+2+(y&&!y.x?2+U(y.font):0);for(b=0;b<d;++b)h=a.measureText(s[b].tit).width,h>q&&(q=h),f.push(h),p+=h;h=c?(B+6)*d+p:9+k+q;a.lineWidth=1;if(q=x.background)M(x.shadowbox),
a.fillStyle=q,a.fillRect(E,A,h,m),N();if(q=x.border)a.strokeStyle=q,a.strokeRect(E,A,h,m);b=0;h=A+3;for(E+=3;b<d;++b){m=s[b];M(x.shadow);a.fillStyle=m.col;a.fillRect(E,h,k,k);N();if(q=x.border2)a.strokeStyle=q,a.strokeRect(E,h,k,k);M(x.shadow);a.textAlign="left";a.textBaseline="top";a.fillStyle=x.color;a.fillText(m.tit,E+3+k,h);N();c?E+=12+k+f[b]:h+=g}a.restore()}if(!e)if(F.onmouseover=F.onmousemove=F.onmouseout=void 0,W=!1,l){ia=a.getImageData(0,0,P,$);if(G)ga[V](G.x,G.y);F.onmouseover=function(a){G=
pa(a)};F.onmousemove=function(b){G&&(r.pie||a.putImageData(ia,0,0),G=pa(b),ga[V](G.x,G.y))};F.onmouseout=function(){G=void 0;a.putImageData(ia,0,0)}}else G=void 0};a.translate(0.5,0.5);h.datas?ya(h.datas):da();if(h.anim){var Ba=100/6,Ha=1/(h.anim*Ba),na;na=function(){Y();1>A&&(A+=Ha,1<=A&&(A=1),setTimeout(na,Ba))};A=0;na()}else Y();return{canvas:F,data:s,clear:function(){s=[];u=0;da();return this},load:function(a){ya(a);return this},cls:function(){return this},draw:function(a){a&&(V=(a||"line").split(":")[0],
r=qa(a),da());Y();return this}}},plotter=harry;