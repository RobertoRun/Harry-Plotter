// harry plotter 0.9
// ~L~ nikomomo@gmail.com 2009-2013
// https://github.com/nikopol/Harry-Plotter
var harry=function(k){var $="#88a4d7 #d685c9 #86d685 #ffc34f #93c2ea #f28989 #f9eb8a".split(" "),H=function(e,a,f){var c;e=e&&e.constructor==Array&&3==e.length?e:(c=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))?[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)]:(c=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))?[2.55*parseFloat(c[1]),2.55*parseFloat(c[2]),2.55*parseFloat(c[3])]:(c=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(c=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))?[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]:[0,0,0];"array"!=typeof a&&(a=[a,a,a]);for(c=0;3>c;++c)e[c]=Math.max(Math.min(e[c]+a[c],255),0);return void 0!=f?"rgba("+e.join(",")+","+f+")":"rgb("+e.join(",")+")"},T=function(e){var a=e.match(/\d+px/i);return a?parseInt(a,10):(a=e.match(/[0-9\.]+em/i))?Math.floor(16*parseFloat(a)):(a=e.match(/\d+pt/i))?Math.floor(1.3333*
parseInt(a,10)):10},na=function(a){var b=Math.floor(a).toString(),f=parseInt(b.substr(0,1),10);return f*parseFloat("1E"+(b.length-1))==a?a:(f+1)*parseFloat("1E"+(b.length-1))},Y=function(a,b){if("object"==typeof b)for(var f in b)a[f]=b[f];return a},oa=function(a){a=a||window.event;if("offsetX"in a)return{x:a.offsetX,y:a.offsetY};var b=a.target;for(a={x:a.pageX,y:a.pageY};b.offsetParent;)a.x-=b.offsetLeft,a.y-=b.offsetTop,b=b.offsetParent;return a},pa=function(a){var b={};for(a=(a||"line").split(":");a.length;)b[a.pop()]=
!0;return b},ga=function(a,b){return b?Math.round(1E3*a/b)/10+"%":"0%"},qa=function(a,b,f,c,g){var d;g||(g={});c||(c=0);var j=g,l,h="";if(b&&(h="function"==typeof b?b(f):b,f))for(l in f)h=h.replace("%"+l,f[l]);j.lines=h.split(/\n|\\n/);g.lh=T(a.font)+c;g.h=g.lines.length*g.lh;g.w=0;for(d in g.lines)if((b=a.measureText(g.lines[d]).width+2*c)>g.w)g.w=b;return g},R;if(k.canvas)R=k.canvas.constructor==HTMLCanvasElement?k.canvas:document.getElementById(k.canvas);else a:{var N=k.container,Ba=k.width||300,
Ca=k.height||150;R=document.createElement("canvas");R.setAttribute("width",Ba+"px");R.setAttribute("height",Ca+"px");if(N){if(N="string"==typeof N?document.getElementById(N):N,!N){R=void 0;break a}}else N=document.body;N.appendChild(R)}var E=R,O=E.width,Z=E.height,a=E.getContext("2d"),ha,ra=k.background,r=pa(k.mode),U=(k.mode||"line").split(":")[0],Da=(k.fill||"s")[0].toLowerCase().replace(/[^nsvhrdl]/g,"s"),I=parseFloat(k.opacity)||1,aa=parseInt(k.linewidth,10)||1,Ea=k.linejoin||"miter",sa=void 0==
k.barspace?"a":parseInt(k.barspace,10),ta=parseInt(k.radiuspoint,10)||0,ua=k.autoscale&&/top/i.test(k.autoscale),ia=k.autoscale&&/bot/i.test(k.autoscale),h=Y({color:"#a0a0a0",font:'normal 9px "Sans Serif"',marks:0,xwidth:0,ywidth:0,ypos:"right"},k.labels),m=!1===k.mouseover?!1:Y({radius:5,linewidth:2*aa,circle:"#888",font:'normal 10px "Sans Serif"',color:"#fff",bullet:"rgba(99,99,99,0.8)",axis:!1,text:"%v"},k.mouseover),F,q=[],V=!1,va,ja,ka,Fa=k.margins?!1:!0,w=k.margins||[0,0,0,0],u=Y({color:"#a0a0a0",
x:[0,100],y:[0,25,50,75,100]},k.grid),z=k.title?Y({font:'bold 12px "Sans Serif"',color:"rgba(4,4,4,0.5)",z:"top"},k.title):!1,y=!1===k.legends?!1:Y({color:"#666",font:'10px "Sans Serif"',layout:"v"},k.legends),s=[],S,B,v=0,J,K,W,x,G,C,D,P,t,ba,A=1,X,ca=function(){var e,b,f,c;v=s.length;S=B=!1;K=J=W=0;h.xwidth=0;a.font=h.font;if(v){for(e=0;e<v;e++)b=s[e],S=!1===S?b.min:Math.min(b.min,S),B=!1===B?b.max:Math.max(b.max,B),b.maxlab&&(h.xwidth=Math.max(h.xwidth,a.measureText(b.maxlab).width));ua&&(B=na(B));
if(r.stack){e=0;for(f=s[0].len;e<f;++e){for(b=c=0;b<v;++b)c+=s[b].val[e]||0;c>J&&(J=ua?na(c):c)}K=ia?J-S:J}else J=B,K=ia?B-S:B;W=ia?S:0;h.ywidth=a.measureText(J||"0").width}h.fontpx=T(h.font);"auto"==h.x&&(h.x=1,h.xauto=!0);/none|false/.test(u.x)&&(u.x=[]);/none|false/.test(u.y)&&(u.y=[]);if(Fa)if(e=r,b=T(h.font),e.pie)b=h.x?2*b:!1===m?0:15,w=[b,b,b,b];else{f=/^l/i.test(h.ypos);c=Math.floor(b/2);var g=h.marks;w=e.vertical?[h.y&&f?b+4:h.x?b:1,h.y?b:1,h.y&&!f?b+4:h.x?b:1,h.x?4+h.xwidth:h.y?b:1]:[h.y?
c:1,h.y&&!f?4+h.ywidth:h.x?b:1,h.x?3+b+g:h.y?b:1,h.y&&f?4+h.ywidth:h.x?c:1]}x=w[3];G=w[0];C=Math.max(O-w[1]-w[3],0);D=Math.max(Z-w[0]-w[2],0);P=x+C;t=G+D},wa=function(a){var b,f=a.values||a,c=a.labels||[],g,d={val:[],lab:[],len:0,sum:0,avg:0,max:0,min:0xffffffffffff,tit:a.title||"dataset#"+(s.length+1),maxlab:"",col:a.color||$[s.length%$.length]};for(b in f)a=parseFloat(f[b]),isNaN(a)&&(a=null),d.val.push(a),g=c[b]||b,g.length>d.maxlab.length&&(d.maxlab=g),d.lab.push(g),d.sum+=a,a>d.max&&(d.max=a),
a&&a<d.min&&(d.min=a);d.len=d.val.length;d.avg=d.len?d.sum/d.len:0;s.push(d)},xa=function(a){if(a instanceof Array&&"object"==typeof a[0])for(var b=0,f=a.length;b<f;++b)wa(a[b]);else wa(a);ca()},da=function(e){var b;switch(Da){case "s":b=H(e,0,I);break;case "l":b=H(e,21,I);break;case "d":b=H(e,-21,I);break;case "v":b=a.createLinearGradient(0,t,0,G);b.addColorStop(0,H(e,-48,I));b.addColorStop(1,H(e,48,I));break;case "h":b=a.createLinearGradient(x,0,P,0);b.addColorStop(0,H(e,-48,I));b.addColorStop(1,
H(e,48,I));break;case "r":b=x+C/2;var f=G+D/2;b=a.createRadialGradient(b,f,0,b,f,D/2);b.addColorStop(0,H(e,-48,I));b.addColorStop(1,H(e,48,I))}return b?a.fillStyle=b:!1},L=function(e){e&&a.hasOwnProperty("shadowBlur")&&(e=e.split(/[ ,;:-]/),a.shadowOffsetX=parseInt(e[0]||1,10),a.shadowOffsetY=parseInt(e[1]||1,10),a.shadowBlur=parseInt(e[2]||1,10),a.shadowColor=e[3]||"#000")},M=function(){a.hasOwnProperty("clearShadow")?a.clearShadow():a.hasOwnProperty("shadowBlur")&&(a.shadowOffsetX=0,a.shadowOffsetY=
0,a.shadowBlur=0)},ya=function(){z&&(L(z.shadow),a.font=z.font,a.textAlign="left",a.textBaseline="top",a.fillStyle=z.color,a.fillText(z.text,void 0==z.x?w[3]+2:z.x,void 0==z.y?w[0]+2:z.y),M())},ea=function(e,b,f,c,g,d){a.save();b=Math.round(b);f=Math.round(f);if(h.x&&0==e%h.x){var j=!0;e=s[0].lab[e]||e;var l=0;a.font=h.font;h.xauto&&d&&(l=a.measureText(e).width,j=!("h"==d&&"center"==c&&b-l/2<ba||"v"==d&&f<ba));j&&(L(h.shadow),a.fillStyle=h.color,a.textAlign=c,a.textBaseline=g,a.fillText(e,b,f),M(),
ba="center"==c?b+l/2:f+h.fontpx)}h.marks&&(a.lineWidth=1,a.beginPath(),a.moveTo(b,t),a.lineTo(b,t+h.marks),a.strokeStyle=h.color,a.stroke());a.restore()},za=function(e,b){a.save();a.font=m.font;var f,c,g=e.length,d,j=f=0,l=T(m.font),h=Math.floor(l/2),k=l+3,n,p,r=O;p=0;n=Z;var v=0,q=0,x,Q;m.sort&&e.sort(function(a,b){return parseFloat(b.v)-parseFloat(a.v)});for(c=0;c<g;c++)q+=e[c].v;for(c=0;c<g;c++)d=e[c],x={v:d.v,l:s[d.nds].lab[d.n],n:d.n,t:s[d.nds].tit,p:d.pct||ga(d.v,q)},d=qa(a,m.text,x,3,d),d.w&&
(d.h2=Math.floor(d.h/2),d.w>j&&(j=d.w),f+=d.h,d.r++,r>d.x-d.r&&(r=d.x-d.r),p<d.x+d.r&&(p=d.x+d.r),n>d.y&&(n=d.y),v<d.y&&(v=d.y));1<g&&(j+=6+l);if(f){m.header&&(m.header.font&&(a.font=m.header.font),Q=qa(a,m.header.text,x,3),Q.w>j&&(j=Q.w),f+=Q.h);f+=3;b?(p=r+(p-r)/2-j/2,p+j>O&&(p=O-1-j)):p+j>=O&&(p=r-j);1>p&&(p=1);p=Math.floor(p);c=p+j;d=n+f/2+f/2;d>t&&(d=t-1);d=Math.floor(d);f=d-f;a.beginPath();a.moveTo(p,d);a.lineTo(c,d);a.lineTo(c,f);a.lineTo(p,f);a.closePath();m.bullet&&(L(m.shadowbox),a.strokStyle=
"",a.fillStyle=m.bullet,a.fill(),M());m.border&&(a.lineWidth=1,a.lineJoin="round",a.strokeStyle=m.border,a.stroke());a.textAlign="left";a.textBaseline="top";j=f+3;if(Q){n=p+3;L(m.header.shadow);a.fillStyle=m.header.color||m.color;for(f=0;f<Q.lines.length;++f,j+=Q.lh)a.fillText(Q.lines[f],n,j);M();a.font=m.font}for(c=0;c<g;c++){d=e[c];n=p+3;1<g&&(a.beginPath(),a.arc(n+h,j+h,h,0,2*Math.PI),a.fillStyle=s[d.nds].col,a.fill(),n+=l+3);L(m.shadow);a.fillStyle=m.color;for(f=0;f<d.lines.length;++f,j+=k)a.fillText(d.lines[f],
n,j);M()}}a.restore()},la={line:function(){var e=v,b=K?D/K:0,f,c,g,d,j,l="curve"==U,k=t+h.marks+2,m=function(a,b,c,e,d,f){for(var g,j,h,n,p,m;d<=f;)if(null===e[d])d++;else if(l){g=b[d];j=c[d];for(d++;d<=f&&null===e[d];)d++;d>f?a.lineTo(g,j):(h=(g+b[d])/2,n=(j+c[d])/2,p=(g+h)/2,m=(j+n)/2,a.quadraticCurveTo(g,j,p,m),p=(h+b[d])/2,m=(n+c[d])/2,a.quadraticCurveTo(h,n,p,m))}else a.lineTo(b[d],c[d]),d++};a.lineWidth=aa;a.lineJoin=Ea;for(q=[];f=s[--e];)if(1<(j=f.len)){var n=[],p=[];for(c=0;c<j;++c){d=0;if(r.stack)for(g=
0;g<=e;g++)d+=s[g].val[c]-W;else d=f.val[c]-W;n.push(x+Math.round(c*(C/(j-1))));p.push(t-Math.round(b*d*A))}q.push({x:n,y:p,v:s[e].val,nds:e});c--;n.push(x+Math.round(c*(C/(j-1))));p.push(t-Math.round(b*d));for(c=0;null===f.val[c];)c++;for(g=j-1;null===f.val[g];)g--;c<=g&&da(f.col)&&(a.beginPath(),a.moveTo(n[c],t),a.lineTo(n[c],p[c]),m(a,n,p,f.val,c,g),a.lineTo(n[g],t),a.closePath(),a.fill());a.strokeStyle=f.col;a.beginPath();a.moveTo(n[c],p[c]);m(a,n,p,f.val,c,g);a.stroke();if(0==e)for(c=0;c<j;++c)ea(c,
n[c],k,"center","top","h");if(ta){a.fillStyle=f.col;for(c=0;c<j;++c)void 0!=f.val[c]&&(a.beginPath(),a.arc(n[c],p[c],ta,0,2*Math.PI),a.closePath(),a.fill())}}},curve:function(){la.line()},chart:function(){q=[];if(v){var e,b,f=s[0].len,c="a"==sa?1<v?4:0:sa,g=r.stack?1:v,d=r.vertical?D:C,d=f&&v?(d-c*(f-1))/f/g-1:0,j,l=G,m,k=x,n,p;e=r.vertical?C:D;var y=t+h.marks+2,u=r.stack?J?e/J:0:B?e/B:0;0>d&&(d=0);a.lineWidth=aa;a.lineJoin="miter";for(b=0;b<v;b++)q.push({x:[],y:[],v:[],nds:b});if(r.vertical)for(e=
0;e<f;e++){ea(e,x-h.marks-2,l,"right","top","v");k=x;for(b=0;b<v;b++)j=s[b],n=r.stack?k:x,k=n+Math.round(u*j.val[e]*A),m=Math.round(l),g=Math.round(l+d),null!==j.val[e]&&(a.beginPath(),a.moveTo(n,m),a.lineTo(n,g),a.lineTo(k,g),a.lineTo(k,m),a.closePath(),da(j.col)&&a.fill(),a.strokeStyle=j.col,a.stroke()),q[b].x.push(k),q[b].y.push(Math.floor(l+d/2)),q[b].v.push(j.val[e]),r.stack||(l+=d+1);l+=r.stack?d+1+c:c}else for(e=0;e<f;e++){ea(e,k+(d+1)*g/2,y,"center","top","h");l=t;for(b=0;b<v;b++)j=s[b],m=
r.stack?l:t,l=m-Math.round(u*j.val[e]*A),n=Math.round(k),p=Math.round(k+d),null!==j.val[e]&&(a.beginPath(),a.moveTo(n,m),a.lineTo(n,l),a.lineTo(p,l),a.lineTo(p,m),a.closePath(),da(j.col)&&a.fill(),a.strokeStyle=j.col,a.stroke()),q[b].x.push(Math.floor(k+d/2)),q[b].y.push(l),q[b].v.push(j.val[e]),r.stack||(k+=d+1);k+=r.stack?d+1+c:c}}},pie:function(){q=[];if(v){var e,b=0,f=[],c=[],g=2*Math.PI,d=[],j=[];if(1<v){var l=0;for(e=0;e<v;e++)l+=s[e].sum;if(l){e=0;for(b=v;e<v;e++)f[e]=A*s[e].sum/l*g,c[e]=s[e].col,
d.push(s[e].sum),j.push(ga(s[e].sum,l))}}else if(l=s[0],l.sum){b=l.len;for(e=0;e<b;e++)f[e]=A*l.val[e]/l.sum*g,c[e]=$[e%$.length],d.push(l.val[e]),j.push(ga(l.val[e],l.sum))}var g=x+Math.round(C/2),l=G+Math.round(D/2),k=Math.min(D/2,C/2)-1,m=k+h.fontpx,n,p,r=1.5*Math.PI,t,u,y,z,w=V;va=k;ja=g;ka=l;V=w;a.lineWidth=aa;a.lineJoin="miter";for(e=0;e<b;e++)t=r+f[e],u=(r+t)/2,q.push({a:r%(2*Math.PI),n:e}),e===w?(n=g+10*Math.cos(u),p=l+10*Math.sin(u)):(n=g,p=l),a.beginPath(),a.moveTo(n,p),a.arc(n,p,k,r,t,
!1),a.closePath(),da(c[e])&&a.fill(),a.strokeStyle=c[e],a.stroke(),e===w?(y=n+m/2*Math.cos(u),z=p+m/2*Math.sin(u)):ea(d[e],n+m*Math.cos(u),p+m*Math.sin(u),"center","middle"),r=t;!1!==w&&za([{x:y,y:z,r:0,v:d[w],pct:j[w],n:w,nds:1<v?w:0}],!0);q.sort(function(a,b){return a.a-b.a})}}},fa={line:function(e,b){var f,c=!1,g,d,j,h=m.linewidth||1,k=[];if(q.length){g=q[0];for(f=0;f<g.x.length;++f)if(void 0!=g.v[f]&&(j=r.vertical?Math.abs(b-g.y[f]):Math.abs(e-g.x[f]),!1===c||j<d))d=j,c=f;if(!1!==c){for(f=0;f<
q.length;++f)if(g=q[f],void 0!=g.v[c]){m.border2&&(a.beginPath(),a.lineWidth=h+2,a.arc(g.x[c],g.y[c],m.radius,0,2*Math.PI),0==m.linewidth?(a.fillStyle=m.border2,a.fill()):(a.strokeStyle=m.border2,a.stroke()));a.beginPath();a.lineWidth=h;a.arc(g.x[c],g.y[c],m.radius,0,2*Math.PI);0==m.linewidth?(a.fillStyle=m.circle,a.fill()):(a.strokeStyle=m.circle,a.stroke());if(m.axis){a.lineWidth=1;if(/x/i.test(m.axis)){for(d=g.y[c]+m.radius;d<t;)a.moveTo(g.x[c],d),d+=2,d>t&&(d=t),a.lineTo(g.x[c],d),d+=2;a.stroke()}if(/y/i.test(m.axis)){for(e=
g.x[c]+m.radius;e<P;)a.moveTo(e,g.y[c]),e+=2,e>P&&(e=P),a.lineTo(e,g.y[c]),e+=2;a.stroke()}}k.push({x:g.x[c],y:g.y[c],r:h/2+1+m.radius,v:g.v[c],n:c,nds:g.nds})}za(k)}}},chart:function(a,b){fa.line(a,b)},curve:function(a,b){fa.line(a,b)},pie:function(a,b){var f,c=0;if(Math.sqrt(Math.pow(a-ja,2)+Math.pow(b-ka,2))<=va){f=Math.PI-Math.atan2(ka-b,a-ja);for(f=(f+3*Math.PI)%(2*Math.PI);c<q.length&&f>q[c].a;)c++;0>--c&&(c=q.length-1);V=q[c].n;X(!0)}else!1!==V&&(V=!1,X(!0))}};X=function(e){ba=-1;a.clearRect(-1,
-1,O+1,Z+1);ra&&(a.fillStyle=ra,a.fillRect(-1,-1,O+1,Z+1));if(!r.pie){var b,f,c;a.lineWidth=u.linewidth||1;a.strokeStyle=u.color;if(u.x){b=0;for(f=u.x.length;b<f;++b)a.beginPath(),r.vertical?(c=G+Math.round(D*u.x[b]/100),a.moveTo(x,c),a.lineTo(P,c)):(c=x+Math.round(C*u.x[b]/100),a.moveTo(c,G),a.lineTo(c,t)),a.stroke()}if(u.y){b=0;for(f=u.y.length;b<f;++b)a.beginPath(),r.vertical?(c=x+Math.round(C*u.y[b]/100),a.moveTo(c,G),a.lineTo(c,t)):(c=t-Math.round(D*u.y[b]/100),a.moveTo(x,c),a.lineTo(P,c)),a.stroke()}}if(v&&
h.y&&!r.pie){var g,d,j=10>K?100:100>K?10:1;L(h.shadow);a.font=h.font;a.fillStyle=h.color;if(r.vertical){a.textAlign="center";b=0;for(f=h.y.length;b<f;++b)c=x+Math.round(C*h.y[b]/100),d=W+K*h.y[b]/100,d=Math.round(j*d)/j,/r/i.test(h.ypos)&&(g=t+1,a.textBaseline="top",a.fillText(d,c,g)),/l/i.test(h.ypos)&&(g=G-2,a.textBaseline="bottom",a.fillText(d,c,g))}else{a.textBaseline="middle";b=0;for(f=h.y.length;b<f;++b)g=t-Math.round(D*h.y[b]/100),d=W+K*h.y[b]/100,d=Math.round(j*d)/j,/r/i.test(h.ypos)&&(c=
P+1,a.textAlign="left",a.fillText(d,c,g)),/l/i.test(h.ypos)&&(c=x-2,a.textAlign="right",a.fillText(d,c,g))}M()}z&&"top"==z.z?(la[U](),ya()):(ya(),la[U]());if(!1!==y&&1<v){a.save();a.font=y.font;var l,k,q,n;f=[];c="h"==y.layout;var p=k=0;g=T(y.font)+3;d=v;var j=g-3,B=6+j;n=c?3+g:3+g*d;q=void 0!=y.x?y.x:w[3]+2;var A=void 0!=y.y?y.y:w[0]+2+(z&&!z.x?2+T(z.font):0);for(b=0;b<d;++b)l=a.measureText(s[b].tit).width,l>k&&(k=l),f.push(l),p+=l;l=c?(B+6)*d+p:9+j+k;a.lineWidth=1;if(k=y.background)L(y.shadowbox),
a.fillStyle=k,a.fillRect(q,A,l,n),M();if(k=y.border)a.strokeStyle=k,a.strokeRect(q,A,l,n);b=0;l=A+3;for(q+=3;b<d;++b){n=s[b];L(y.shadow);a.fillStyle=n.col;a.fillRect(q,l,j,j);M();if(k=y.border2)a.strokeStyle=k,a.strokeRect(q,l,j,j);L(y.shadow);a.textAlign="left";a.textBaseline="top";a.fillStyle=y.color;a.fillText(n.tit,q+3+j,l);M();c?q+=12+j+f[b]:l+=g}a.restore()}if(!e)if(E.onmouseover=E.onmousemove=E.onmouseout=void 0,V=!1,m){ha=a.getImageData(0,0,O,Z);if(F)fa[U](F.x,F.y);E.onmouseover=function(a){F=
oa(a)};E.onmousemove=function(b){F&&(r.pie||a.putImageData(ha,0,0),F=oa(b),fa[U](F.x,F.y))};E.onmouseout=function(){F=void 0;a.putImageData(ha,0,0)}}else F=void 0};a.translate(0.5,0.5);k.datas?xa(k.datas):ca();if(k.anim){var Aa=100/6,Ga=1/(k.anim*Aa),ma;ma=function(){X();1>A&&(A+=Ga,1<=A&&(A=1),setTimeout(ma,Aa))};A=0;ma()}else X();return{canvas:E,data:s,clear:function(){s=[];v=0;ca();return this},load:function(a){xa(a);return this},cls:function(){return this},draw:function(a){a&&(U=(a||"line").split(":")[0],
r=pa(a),ca());X();return this}}},plotter=harry;